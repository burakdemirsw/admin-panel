<main id="main" class="main">
  <section class="section">
    <!-- Kupon Ekleme Dialog -->
    <p-dialog header="İndirim Kuponu Tanımla" [(visible)]="couponDialog" [modal]="true" [style]="{width: '50vh'}">
      <div class="form-group">
        <label for="type">Yüzde İndirim Mi?</label>

        <p-inputSwitch id="type" type="text" class="form-control" [(ngModel)]="couponType"
          placeholder="Yüzdelik için true, sabit için false" />
      </div>
      <div class="form-group">
        <label for="value">İndirim Değeri</label>
        <input id="value" type="number" class="form-control" [(ngModel)]="couponValue"
          placeholder="İndirim Değerini Girin">
      </div>
      <div class="form-group">
        <label for="response">Gelen Yanıt</label>
        <input id="response" type="text" class="form-control" [(ngModel)]="couponResponse" readonly>
      </div>
      <p-footer>
        <p-button label="Oluştur" icon="pi pi-check" (click)="createCoupon(couponType, couponValue)"></p-button>
      </p-footer>
    </p-dialog>



    <p-table #dt2 [value]="offers" [(selection)]="selectedOffers" dataKey="orderNo" [paginator]="true"
      [rowsPerPageOptions]="[5, 10, 20]" [rows]="10" [resizableColumns]="true" styleClass="p-datatable-gridlines"
      [tableStyle]="{ 'min-width': '70rem' }">

      <ng-template pTemplate="caption">
        <div class="p-d-flex p-jc-between p-ai-center">
          <h5>{{ selectedOffers.length }}/{{ offers.length }} Adet Sipariş Seçildi</h5>
          <p-button icon="pi pi-plus" label="İndirim Kuponu Tanımla" (onClick)="this.couponDialog =true"></p-button>
          <p-button icon="pi pi-plus" label="Servisi Çalıştır" (onClick)="runOfferService()"></p-button>
        </div>
      </ng-template>

      <ng-template pTemplate="header">
        <tr>
          <th pSortableColumn="orderNo">Sipariş Numarası<p-sortIcon field="orderNo"></p-sortIcon>
          </th>
          <th pSortableColumn="customerName">Müşteri Adı<p-sortIcon field="customerName"></p-sortIcon>
          </th>
          <th pSortableColumn="customerSurname">Müşteri Soyadı<p-sortIcon field="customerSurname"></p-sortIcon>
          </th>
          <th pSortableColumn="childName">Çocuk Adı<p-sortIcon field="childName"></p-sortIcon>
          </th>
          <th pSortableColumn="childSurname">Çocuk Soyadı<p-sortIcon field="childSurname"></p-sortIcon>
          </th>
          <th pSortableColumn="childBornDate">Doğum Tarihi<p-sortIcon field="childBornDate"></p-sortIcon>
          </th>
          <th>İşlemler</th>
        </tr>
        <tr>
          <th>
            <p-columnFilter type="text" field="orderNo" [showClearButton]="false"></p-columnFilter>
          </th>
          <th>
            <p-columnFilter type="text" field="customerName" [showClearButton]="false"></p-columnFilter>
          </th>
          <th>
            <p-columnFilter type="text" field="customerSurname" [showClearButton]="false"></p-columnFilter>
          </th>
          <th>
            <p-columnFilter type="text" field="childName" [showClearButton]="false"></p-columnFilter>
          </th>
          <th>
            <p-columnFilter type="text" field="childSurname" [showClearButton]="false"></p-columnFilter>
          </th>
          <th>
            <p-columnFilter type="date" field="childBornDate" [showClearButton]="false"></p-columnFilter>
          </th>
          <th></th>
        </tr>
      </ng-template>

      <ng-template pTemplate="body" let-offer>
        <tr>
          <td>{{ offer.orderNo }}</td>
          <td>{{ offer.customerName }}</td>
          <td>{{ offer.customerSurname }}</td>
          <td>{{ offer.childName }}</td>
          <td>{{ offer.childSurname }}</td>
          <td>{{ offer.childBornDate | date: 'dd/MM/yyyy' }}</td>
          <td>
            <div class="p-d-flex">
              <button pButton icon="pi pi-eye" class="p-button-rounded p-button-info p-mr-2"
                (click)="viewDetails(offer)" [disabled]="offer.ideasoftOfferDetails.length < 1"></button>
              <button pButton icon="pi pi-trash" class="p-button-rounded p-button-danger"
                (click)="deleteOffer(offer.id)"></button>
            </div>
          </td>
        </tr>
      </ng-template>

      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="7">Hiçbir sipariş bulunamadı.</td>
        </tr>
      </ng-template>
    </p-table>

    <!-- Kuponları Gösteren Dialog -->
    <p-dialog header="Kupon Detayları" [(visible)]="dialog" [modal]="true" [style]="{width: '80vh'}">
      <p-table [value]="selectedCoupons">
        <ng-template pTemplate="header">
          <tr>
            <th>Kupon Kodu</th>
            <th>Oluşturulma Tarihi</th>
            <th>Bitiş Tarihi</th>
            <th>Değer</th>
            <th>İndirim Türü</th>
            <th>İşlemler</th> <!-- İşlemler sütunu eklendi -->
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-coupon>
          <tr>
            <td>{{ coupon.coupon }}</td>
            <td>{{ coupon.couponCreatedDate | date: 'dd/MM/yyyy' }}</td>
            <td>{{ coupon.couponEndDate | date: 'dd/MM/yyyy' }}</td>
            <td>{{ coupon.couponValue }}</td>
            <td>{{ coupon.isPercentageDiscount ? 'Yüzdelik' : 'Sabit' }}</td>
            <td>
              <button pButton icon="pi pi-trash" class="p-button-rounded p-button-danger p-mr-2"
                (click)="deleteOfferDetail(coupon.id)"></button>
              <!-- Silme butonu eklendi -->
            </td>
          </tr>
        </ng-template>
      </p-table>
    </p-dialog>


  </section>
</main>
