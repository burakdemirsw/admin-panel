<main id="main" class="main">
  <section class="section">
    <div class="">
      <div class="row">
        <div class="col-md-6">
          <div class="card text-center card-hover">
            <div class="card-body">
              <h5 class="card-title">Yapılacak Görev Sayısı</h5>
              <h1>{{ this.raport.unfinishedCount }}</h1>
            </div>
          </div>
        </div>
        <div class="col-md-6">
          <div class="card text-center card-hover">
            <div class="card-body">
              <h5 class="card-title">Kontrol Edilen Görev Sayısı</h5>
              <h1>{{ this.raport.dailyLooked }}</h1>
            </div>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="col-md-6">
          <div class="card text-center card-hover">
            <div class="card-body">
              <h5 class="card-title">Bugün Oluşturulan Görev Sayısı</h5>
              <h1>{{ this.raport.dailyCreatedCount }}</h1>
            </div>
          </div>
        </div>
        <div class="col-md-6">
          <div class="card text-center card-hover">
            <div class="card-body">
              <h5 class="card-title">Bu Hafta Tamamlanan Görev Sayısı</h5>
              <h1>{{ this.raport.weeklyCompletedCount }}</h1>
            </div>
          </div>
        </div>
      </div>
      <div class="row mb-3">
        <div class="col-md-12 mb-3">
          <p-panel header="Filtre" [collapsed]="false" [toggleable]="true">
            <form [formGroup]="searchTaskForm">
              <div class="row mb-3">
                <div class="col-md-3 mb-3">
                  <div class="form-group">
                    <select class="form-control" id="zone" formControlName="searchTask_DevelopmentId">
                      <option *ngFor="let dev of devolopments" value="{{ dev.id }}">
                        {{ dev.zone }}
                      </option>
                    </select>
                  </div>
                </div>

                <div class="col-md-3 mb-3">
                  <div class="form-group">
                    <select class="form-control" id="zone" formControlName="searchTask_IsCompleted">
                      < <option *ngFor="let opt of optionList" [value]="opt.value">
                        {{ opt.label }}
                        </option>
                    </select>
                  </div>
                </div>
                <div class="col-md-2 mb-3">
                  <div class="form-group">
                    <button class="btn btn-success" style="width: 100%" (click)="
                        getAllDevelopments(
                          this.searchTaskForm.value.searchTask_IsCompleted,
                          this.searchTaskForm.value.searchTask_DevelopmentId
                        )
                      ">
                      <i class="fa fa-search" aria-hidden="true"></i>
                    </button>
                  </div>
                </div>

                <div class="col-md-2 mb-3">
                  <button class="btn btn-success" (click)="addTaskVisible = true" style="width: 100%">
                    Görev Ekle
                  </button>
                </div>
                <div class="col-md-2 mb-3">
                  <button class="btn btn-success" (click)="addZoneVisible = true" style="width: 100%">
                    Başlık Ekle
                  </button>
                </div>
              </div>
            </form>
          </p-panel>
        </div>
      </div>

      <div class="row">
        <div class="col-md-12">
          <div class="card">
            <div class="card-body">
              <!-- <h5 class="card-title">Geliştirmeler</h5> -->

              <p-table #dt2 [value]="tasks" [(selection)]="selectedTasks" dataKey="id" [paginator]="true"
                [rowsPerPageOptions]="[10, 20, 50]" [resizableColumns]="true" expandableRows="true"
                columnResizeMode="expand" styleClass="p-datatable-gridlines" [rows]="20"
                styleClass="p-datatable-striped"
                currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries">
                <ng-template pTemplate="caption">

                  <h5 *ngIf="selectedTasks.length > 0" style="text-align: left">
                    {{ selectedTasks.length }}/{{ tasks.length }} Adet Görev Seçildi
                  </h5>
                </ng-template>

                <ng-template pTemplate="header">
                  <tr>

                    <th pSortableColumn="id">
                      Id
                      <p-sortIcon field="id"></p-sortIcon>
                    </th>
                    <th pSortableColumn="zone">
                      Sayfa
                      <p-sortIcon field="zone"></p-sortIcon>
                    </th>
                    <th pSortableColumn="header">
                      Başlık
                      <p-sortIcon field="header"></p-sortIcon>
                    </th>
                    <th pSortableColumn="description">
                      Açıklama
                      <p-sortIcon field="description"></p-sortIcon>
                    </th>
                    <th pSortableColumn="isCompleted">
                      Sonuç
                      <p-sortIcon field="isCompleted"></p-sortIcon>
                    </th>
                    <th pSortableColumn="createdDate">
                      Oluşturulma Zamanı
                      <p-sortIcon field="createdDate"></p-sortIcon>
                    </th>
                    <th pSortableColumn="finishedDate">
                      Tamamlanma Zamanı
                      <p-sortIcon field="finishedDate"></p-sortIcon>
                    </th>
                    <th>İşlemler</th>
                  </tr>
                  <tr>

                    <th>
                      <p-columnFilter type="text" field="id" [showClearButton]="false"></p-columnFilter>
                    </th>
                    <th>
                      <p-columnFilter type="text" field="zone" [showClearButton]="false"></p-columnFilter>
                    </th>
                    <th>
                      <p-columnFilter type="text" field="header" [showClearButton]="false"></p-columnFilter>
                    </th>
                    <th>
                      <p-columnFilter type="text" field="description" [showClearButton]="false"></p-columnFilter>
                    </th>
                    <th>
                      <p-columnFilter type="boolean" field="isCompleted" [showClearButton]="false"></p-columnFilter>
                    </th>
                    <th>
                      <p-columnFilter type="date" field="createdDate" [showClearButton]="false"></p-columnFilter>
                    </th>
                    <th>
                      <p-columnFilter type="date" field="finishedDate" [showClearButton]="false"></p-columnFilter>
                    </th>
                    <th></th>
                  </tr>
                </ng-template>

                <ng-template pTemplate="body" let-task let-i="rowIndex">
                  <tr>

                    <td>{{ i + 1 }}</td>
                    <td>{{ task.zone }}</td>
                    <td>{{ task.header }}</td>
                    <td (click)="openModal(task)" style="cursor :pointer !important; ">
                      <p-editor [(ngModel)]="task.description" [readonly]="true" [style]="{ height: '200px' }"
                        *ngIf="task.description"></p-editor>
                    </td>
                    <td>
                      <span class="btn" [ngClass]="{
            'btn-success': task.isCompleted,
            'btn-warning': !task.isCompleted,
            blinking: !task.isCompleted
          }">
                        <i *ngIf="task.isCompleted" class="fa fa-check"></i>
                        <i *ngIf="!task.isCompleted" class="fa fa-exclamation"></i>
                      </span>
                    </td>
                    <td>
                      {{ task.createdDate | date : "dd.MM.yyyy HH:mm" }}
                    </td>
                    <td>
                      {{ task.finishedDate | date : "dd.MM.yyyy HH:mm" }}
                    </td>
                    <td>
                      <button type="button" class="btn btn-primary dropdown-toggle" data-bs-toggle="dropdown"
                        aria-expanded="true">
                      </button>
                      <ul class="dropdown-menu">
                        <li>
                          <a class="dropdown-item" (click)="updateTaskStatus(task, true)">
                            <i class="fa fa-check"></i> Tamamla
                          </a>
                        </li>
                        <li>
                          <a class="dropdown-item" (click)="updateTaskStatus(task, false)">
                            <i class="fa fa-times"></i> İptal Et
                          </a>
                        </li>
                        <li>
                          <a class="dropdown-item" (click)="openModal(task)">
                            <i class="fa fa-pencil"></i> Düzenle
                          </a>
                        </li>
                        <li>
                          <a class="dropdown-item" (click)="deleteTask(task)">
                            <i class="fa fa-trash"></i> Sil
                          </a>
                        </li>
                      </ul>
                    </td>
                  </tr>
                </ng-template>
              </p-table>

            </div>
          </div>
        </div>
      </div>
      <p-dialog header="{{ this.selectedTask.id }}-Açıklama Güncelle" [(visible)]="visible" [modal]="true"
        [style]="{ width: '80vw' }" [draggable]="false" [resizable]="false">
        <div class="row mb-3">
          <div class="col-md-12">
            <div class="form-group">
              <input type="text" class="form-control" placeholder="Başlık" [(ngModel)]="updateTask_Header" />
            </div>
          </div>
        </div>
        <div class="row mb-3">
          <div class="col-md-12">
            <p-editor [(ngModel)]="description" [style]="{ height: '320px' }"></p-editor>
          </div>
        </div>
        <div class="row">
          <div class="col-md-6">
            <button class="btn btn-success" (click)="updateTaskDescription()">
              Güncelle
            </button>
          </div>
        </div>
      </p-dialog>

      <p-dialog header="Başlık Ekle" [(visible)]="addZoneVisible" [modal]="true" [style]="{ width: '50vw' }"
        [draggable]="false" [resizable]="false">
        <div class="row mb-3">
          <div class="col-md-12">
            <input type="search" class="form-control" placeholder="Başlık Ekle" [(ngModel)]="zone"
              (keyup.enter)="addZone()" />
          </div>
        </div>
        <div class="row mb-3">
          <div class="col-md-6">
            <button class="btn btn-success" (click)="addZone()">Ekle</button>
          </div>
        </div>
      </p-dialog>

      <p-dialog header="Görev Ekle" [(visible)]="addTaskVisible" [modal]="true" [style]="{ width: '80vw' }"
        [draggable]="false" [resizable]="false">
        <div class="row mb-3">
          <div class="col-md-12">
            <div class="form-group">
              <select class="form-control" id="zone" [(ngModel)]="addTask_Zone">
                <option *ngFor="let dev of devolopments" value="{{ dev.id }}">
                  {{ dev.zone }}
                </option>
              </select>
            </div>
          </div>
        </div>
        <div class="row mb-3">
          <div class="col-md-12">
            <div class="form-group">
              <input type="text" class="form-control" placeholder="Başlık" [(ngModel)]="addTask_Header"
                (keyup.enter)="addTask()" />
            </div>
          </div>
        </div>
        <div class="row mb-3">
          <div class="form-group">
            <p-editor [(ngModel)]="addTask_Description" [style]="{ height: '200px' }" (keyup.enter)="addTask()">
            </p-editor>
          </div>
        </div>

        <div class="row mb-3">
          <div class="form-group">
            <button class="btn btn-success" (click)="addTask()">Ekle</button>
          </div>
        </div>
      </p-dialog>
    </div>
  </section>
</main>
