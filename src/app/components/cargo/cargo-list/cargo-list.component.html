<main id="main" class="main">
  <section class="section">
    <div class="card custom-card mb-3">
      <div class="card-body">
        <div class="card-body d-flex justify-content-start mt-3" style="overflow-x: auto">
          <button type="button" class="btn btn-primary" (click)="getCargos(true)">
            <i class="fas fa-check"></i> Yazdırılan Kargolar
          </button>
          <button type="button" class="btn btn-primary" (click)="getCargos(false)">
            <i class="fas fa-times"></i> Yazdırılmayan Kargolar
          </button>
        </div>
      </div>
    </div>

    <div class="card">
      <p-table [value]="cargos" [paginator]="true" [rows]="50" [tableStyle]="{'min-width': '50rem'}"
        [responsiveLayout]="'scroll'" [filterDelay]="500">
        <ng-template pTemplate="caption">
          <div class="flex align-items-center justify-content-between">
            Kargo Listesi
          </div>
        </ng-template>
        <ng-template pTemplate="header">
          <tr>
            <th pSortableColumn="cargoFirmId">
              Kargo Şirketi
              <p-sortIcon field="cargoFirmId"></p-sortIcon>
            </th>
            <th pSortableColumn="customer">
              Müşteri
              <p-sortIcon field="customer"></p-sortIcon>
            </th>
            <th pSortableColumn="orderNo">
              Sipariş Numarası
              <p-sortIcon field="orderNo"></p-sortIcon>
            </th>
            <th pSortableColumn="referenceId">
              Referans Id
              <p-sortIcon field="referenceId"></p-sortIcon>
            </th>
            <th pSortableColumn="shipmentId">
              Gönderi Id
              <p-sortIcon field="shipmentId"></p-sortIcon>
            </th>
            <th pSortableColumn="createdDate">
              Oluşturulma Zamanı
              <p-sortIcon field="createdDate"></p-sortIcon>
            </th>
            <th pSortableColumn="packagingType">
              Paketleme Türü
              <p-sortIcon field="packagingType"></p-sortIcon>
            </th>
            <th pSortableColumn="isPrinted">
              Yazdırma Durumu
              <p-sortIcon field="isPrinted"></p-sortIcon>
            </th>
            <th>İşlemler</th>
          </tr>
          <tr>
            <th>
              <p-columnFilter type="text" field="cargoFirmId" [showClearButton]="false"></p-columnFilter>
            </th>
            <th>
              <p-columnFilter type="text" field="customer" [showClearButton]="false"></p-columnFilter>
            </th>
            <th>
              <p-columnFilter type="text" field="orderNo" [showClearButton]="false"></p-columnFilter>
            </th>
            <th>
              <p-columnFilter type="text" field="referenceId" [showClearButton]="false"></p-columnFilter>
            </th>
            <th>
              <p-columnFilter type="text" field="shipmentId" [showClearButton]="false"></p-columnFilter>
            </th>
            <th>
              <p-columnFilter type="date" field="createdDate" [showClearButton]="false"></p-columnFilter>
            </th>
            <th>
              <p-columnFilter type="text" field="packagingType" [showClearButton]="false"></p-columnFilter>
            </th>
            <th>
              <p-columnFilter type="boolean" field="isPrinted" [showClearButton]="false"></p-columnFilter>
            </th>
            <th>
              <!-- İşlemler sütunu için filtre eklemiyoruz -->
            </th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-cargo let-i="rowIndex">
          <tr>
            <td>{{ cargo.cargoFirmId === 1 ? "MNG" : "ARAS" }}</td>
            <td>{{ cargo.customer }}</td>
            <td>{{ cargo.orderNo }}</td>
            <td>{{ cargo.referenceId }}</td>
            <td>{{ cargo.shipmentId }}</td>
            <td>{{ cargo.createdDate | date : "dd.MM.yyyy HH:mm" }}</td>
            <td>
              {{
                    cargo.packagingType === 1
                      ? "DOSYA"
                      : cargo.packagingType === 3
                      ? "PAKET"
                      : "KOLİ"
                }}
            </td>
            <td>
              <button class="btn" [ngClass]="{
                    'btn-success': cargo.isPrinted === true,
                    'btn-danger': cargo.isPrinted === false
                }">
                <i *ngIf="cargo.isPrinted === true" class="fa fa-check" aria-hidden="true"></i>
                <i *ngIf="cargo.isPrinted === false" class="fa-solid fa-ban" aria-hidden="true"></i>
              </button>
            </td>
            <td>
              <div class="btn-group">
                <button class="btn btn-success" data-text="Kargo" (click)="getCargoDetail(cargo, false)">
                  <i class="fa fa-truck" aria-hidden="true"></i>
                </button>
                <button class="btn btn-success ml-2" data-text="Kargo" (click)="createBarcode(cargo.referenceId)">
                  <i class="fa fa-print" aria-hidden="true"></i>
                </button>
                <button class="btn btn-success ml-2" data-text="Kargo" (click)="getCargoDetail(cargo, true)">
                  <i class="fa fa-bars" aria-hidden="true"></i>
                </button>
                <button class="btn btn-danger ml-2" data-text="Kargo" (click)="deleteCargo(cargo, cargo.cargoFirmId)">
                  <i class="fa fa-trash" aria-hidden="true"></i>
                </button>
              </div>
            </td>
          </tr>
        </ng-template>
      </p-table>

    </div>

    <p-dialog header="Kargo Detayı" [(visible)]="visible" [modal]="true" [style]="{ width: '80vw' }" [draggable]="false"
      [resizable]="false">
      <div class="container mt-4">
        <div class="card">
          <div class="card-header">Kargo Detayı</div>
          <div class="card-body">
            <ul class="list-group list-group-flush">
              <!-- <li class="list-group-item">
                Sipariş Numarası: {{ packageStatus?.orderId }}
              </li>
              <li class="list-group-item">
                Referans ID: {{ packageStatus?.referenceId }}
              </li>
              <li class="list-group-item">
                Gönderi ID: {{ packageStatus?.shipmentId }}
              </li> -->
              <li class="list-group-item">
                Göderi Seri Numarası:
                {{ packageStatus?.shipmentSerialandNumber }}
              </li>
              <li class="list-group-item">
                Gönderi Zamanı: {{ packageStatus?.shipmentDateTime }}
              </li>
              <li class="list-group-item">
                Gönderi Durumu: {{ packageStatus?.shipmentStatus }}
              </li>
              <li class="list-group-item">
                Gönderi Durum Kodu: {{ packageStatus?.shipmentStatusCode }}
              </li>
              <li class="list-group-item">
                Gönderi Durum Açıklaması:
                {{ packageStatus?.shipmentStatusExplanation }}
              </li>
              <li class="list-group-item">
                Durum Zamanı:
                {{ packageStatus?.statusDateTime | date : "dd.MM.yyyy HH:mm" }}
              </li>
              <li class="list-group-item">
                MNG Takip Linki:
                <a href="{{ packageStatus?.trackingUrl }}" target="_blank">Takip Sayfası</a>
              </li>
              <!-- <li class="list-group-item">
                Is Delivered: {{ packageStatus?.isDelivered ? "Yes" : "No" }}
              </li>
              <li class="list-group-item">
                Delivery Date Time: {{ packageStatus?.deliveryDateTime }}
              </li>
              <li class="list-group-item">
                Delivery To: {{ packageStatus?.deliveryTo }}
              </li>
              <li class="list-group-item">
                Retrieve Shipment ID: {{ packageStatus?.retrieveShipmentId }}
              </li> -->
            </ul>
          </div>
        </div>
      </div>
    </p-dialog>
  </section>
</main>
