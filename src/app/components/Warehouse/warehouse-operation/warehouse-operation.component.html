<main id="main" class="main">
  <section class="section">
    <div class="row">
      <div style="width: 100%">
        <div class="card" *ngIf="_inventoryItems.length > 0">
          <div class="card-body">
            <h5 class="card-title">Transfer Edilecek Ürünler</h5>
            <div class="table-responsive">
              <table class="table table-striped">
                <thead>
                  <tr>
                    <th *ngFor="let item of _inventoryItemColums" scope="col">
                      {{ item }}
                    </th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of _inventoryItems; let i = index">
                    <td>
                      <p-image src="{{ item.photoUrl }}" alt="Image" width="50" [preview]="true"></p-image>
                    </td>
                    <td>{{ item.shelfNo }}</td>
                    <td>{{ item.itemCode }}</td>
                    <td>{{ item.transferQty }}</td>
                    <td>{{ item.uD_Stock }}</td>
                    <td>{{ item.mD_Stock }}</td>

                    <td>{{ item.itemDescription }}</td>
                    <td>{{ item.barcode }}</td>
                    <td>
                      <div class="btn-group" role="group">
                        <button class="btn btn-primary" type="submit" (click)="
                            goDown2(
                              item.barcode,
                              item.shelfNo,
                              item.itemCode,
                              item.transferQty
                            )
                          ">
                          <i class="fa fa-angle-down"></i>
                        </button>

                        <button data-toggle="tooltip" data-placement="right" title="Raflar" class="btn btn-primary"
                          type="submit" (click)="getShelves(item.barcode)">
                          <i class="fa-solid fa-bars"></i>
                        </button>

                        <button data-toggle="tooltip" data-placement="right" title="Raflar" class="btn btn-primary"
                          type="submit" (click)="pasteItemToForm(item)">
                          <i class="fa-solid fa-file"></i>
                        </button>

                        <button class="btn btn-primary" type="submit" (click)="addDeletedItemList(item)">
                          <i class="fa fa-trash"></i>
                        </button>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <div class="card custom-card mb-3">
          <div class="p-4 card-body d-flex justify-content-start" style="overflow-x: auto">
            <button type="button" class="btn btn-primary" (click)="goPage('0')">
              Standart
            </button>
            <button type="button" class="btn btn-primary" style="margin-right: 1rem" (click)="goPage('1')">
              Raf Fulle
            </button>
          </div>
        </div>

        <div class="card mobile">
          <div class="card-body">
            <form class="mt-4" [formGroup]="warehouseForm" (ngSubmit)="onSubmit(warehouseForm.value)">
              <!-- Form alanları -->
              <div class="row mb-3">
                <div class="form-group col">
                  <p-dropdown formControlName="office" [options]="offices" [showClear]="true"
                    placeholder="Hangi Ofisten"></p-dropdown>
                </div>
                <div class="form-group col">
                  <p-dropdown formControlName="warehouse" [options]="warehouses" [showClear]="true"
                    placeholder="Hangi Depodan"></p-dropdown>
                </div>
              </div>
              <div class="row mb-3">
                <div class="form-group col">
                  <p-dropdown formControlName="officeTo" [options]="offices" [showClear]="true"
                    placeholder="Hangi Ofise"></p-dropdown>
                </div>
                <div class="form-group col">
                  <p-dropdown formControlName="warehouseTo" [options]="warehouses" [showClear]="true"
                    placeholder="Hangi Depoya"></p-dropdown>

                  <!-- </select> -->
                </div>
              </div>
              <div class="row mb-3">
                <div class="form-group">
                  <div class="input-group">
                    <input placeholder="{{
                        shelfNumbers != 'RAFLAR:' ? shelfNumbers : 'Raf No'
                      }}" pInputText type="text" id="shelfNo" class="form-control" formControlName="shelfNo"
                      (keydown.enter)="focusNextInput('barcode')" />
                    <div class="input-group-append">
                      <button type="button" style="height: 100%" (click)="clearShelfNumbers()" class="btn btn-primary">
                        Formu Temizle
                      </button>
                    </div>
                  </div>
                </div>
                <!-- <label *ngIf="shelfNumbers !== 'RAFLAR:'" for="shelfNo">{{
                  shelfNumbers
                }}</label> -->
              </div>

              <div class="row mb-3">
                <div class="form-group">
                  <label *ngIf="qrBarcodeUrl !== ''" for="qrBarcode">{{
                    qrBarcodeUrl
                  }}</label>
                  <input placeholder="Barkod" pInputText type="text" id="barcode" class="form-control"
                    formControlName="barcode" (keydown.enter)="onSubmit(this.warehouseForm.value)" />
                </div>
              </div>

              <div class="row mb-3">
                <div class="form-group col">
                  <input pInputText placeholder="Toplam Stok" type="number" id="quantity" class="form-control"
                    formControlName="quantity" (keydown.enter)="focusNextInput2()" />
                </div>
                <div class="form-group col">
                  <input placeholder="Parti" pInputText type="text" id="batchCode" class="form-control"
                    formControlName="batchCode" (keydown.enter)="focusNextInput('itemCode')" />
                </div>
              </div>
              <div class="row mb-3">
                <div class="form-group col">
                  <button type="button" class="btn btn-primary" style="width: 100%"
                    (click)="onSubmit(warehouseForm.value)">
                    Ekle
                  </button>
                </div>
                <div class="form-group col">
                  <button type="button" class="btn btn-primary" style="color: white; width: 100%"
                    (click)="transferToNebim(this.currentOrderNo)">
                    Transferi Tamamla
                  </button>
                </div>
              </div>
            </form>
          </div>
        </div>
        <div class="card" *ngIf="inventoryItems.length > 0">
          <p-table [value]="inventoryItems" [paginator]="true" [rows]="10" [tableStyle]="{'min-width': '50rem'}"
            [responsiveLayout]="'scroll'" [filterDelay]="500">
            <ng-template pTemplate="caption">
              <div class="flex align-items-center justify-content-between">
                Transfer Edilcek Ürünler
              </div>
            </ng-template>
            <ng-template pTemplate="header">
              <tr>
                <th pSortableColumn="index">
                  #
                  <p-sortIcon field="index"></p-sortIcon>
                </th>
                <th>Resim</th>
                <th pSortableColumn="shelfNo">
                  Raf No
                  <p-sortIcon field="shelfNo"></p-sortIcon>
                </th>
                <th pSortableColumn="itemCode">
                  Ürün Kodu
                  <p-sortIcon field="itemCode"></p-sortIcon>
                </th>
                <th pSortableColumn="transferQty">
                  Transfer Miktarı
                  <p-sortIcon field="transferQty"></p-sortIcon>
                </th>
                <th pSortableColumn="uD_Stock">
                  UD Stok
                  <p-sortIcon field="uD_Stock"></p-sortIcon>
                </th>
                <th pSortableColumn="mD_Stock">
                  MD Stok
                  <p-sortIcon field="mD_Stock"></p-sortIcon>
                </th>
                <th pSortableColumn="itemDescription">
                  Ürün Açıklaması
                  <p-sortIcon field="itemDescription"></p-sortIcon>
                </th>
                <th pSortableColumn="barcode">
                  Barkod
                  <p-sortIcon field="barcode"></p-sortIcon>
                </th>
              </tr>
              <tr>
                <th>
                  <!-- Index sütunu için filtre eklemiyoruz -->
                </th>
                <th>
                  <!-- Resim sütunu için filtre eklemiyoruz -->
                </th>
                <th>
                  <p-columnFilter type="text" field="shelfNo" [showClearButton]="false"></p-columnFilter>
                </th>
                <th>
                  <p-columnFilter type="text" field="itemCode" [showClearButton]="false"></p-columnFilter>
                </th>
                <th>
                  <p-columnFilter type="numeric" field="transferQty" [showClearButton]="false"></p-columnFilter>
                </th>
                <th>
                  <p-columnFilter type="numeric" field="uD_Stock" [showClearButton]="false"></p-columnFilter>
                </th>
                <th>
                  <p-columnFilter type="numeric" field="mD_Stock" [showClearButton]="false"></p-columnFilter>
                </th>
                <th>
                  <p-columnFilter type="text" field="itemDescription" [showClearButton]="false"></p-columnFilter>
                </th>
                <th>
                  <p-columnFilter type="text" field="barcode" [showClearButton]="false"></p-columnFilter>
                </th>
              </tr>
            </ng-template>
            <ng-template pTemplate="body" let-item let-i="rowIndex">
              <tr>
                <td>{{ i + 1 }}</td>
                <td>
                  <p-image src="{{ item.photoUrl }}" alt="Image" width="50" [preview]="true"></p-image>
                </td>
                <td>{{ item.shelfNo }}</td>
                <td>{{ item.itemCode }}</td>
                <td>{{ item.transferQty }}</td>
                <td>{{ item.uD_Stock }}</td>
                <td>{{ item.mD_Stock }}</td>
                <td>{{ item.itemDescription }}</td>
                <td>{{ item.barcode }}</td>
              </tr>
            </ng-template>
          </p-table>

        </div>
        <div class="card" *ngIf="warehouseTransferForms.length > 0">
          <p-table [value]="warehouseTransferForms" [paginator]="true" [rows]="10" [tableStyle]="{'min-width': '50rem'}"
            [responsiveLayout]="'scroll'" [filterDelay]="500">
            <ng-template pTemplate="caption">
              <div class="flex align-items-center justify-content-between">
                Eklenen Ürünler
              </div>
            </ng-template>
            <ng-template pTemplate="header">
              <tr>
                <th pSortableColumn="id">
                  Id
                  <p-sortIcon field="id"></p-sortIcon>
                </th>
                <th>Resim</th>
                <th pSortableColumn="shelfNo">
                  Raf
                  <p-sortIcon field="shelfNo"></p-sortIcon>
                </th>
                <th pSortableColumn="itemCode">
                  Ürün Kodu
                  <p-sortIcon field="itemCode"></p-sortIcon>
                </th>
                <th pSortableColumn="batchCode">
                  Parti
                  <p-sortIcon field="batchCode"></p-sortIcon>
                </th>
                <th pSortableColumn="barcode">
                  Barkod
                  <p-sortIcon field="barcode"></p-sortIcon>
                </th>
                <th pSortableColumn="quantity">
                  Stok Miktarı
                  <p-sortIcon field="quantity"></p-sortIcon>
                </th>
                <th pSortableColumn="warehouse">
                  Gönderen Depo
                  <p-sortIcon field="warehouse"></p-sortIcon>
                </th>
                <th pSortableColumn="warehouseTo">
                  Hedef Depo
                  <p-sortIcon field="warehouseTo"></p-sortIcon>
                </th>
                <th pSortableColumn="availableQty">
                  Güncel Stok Adedi
                  <p-sortIcon field="availableQty"></p-sortIcon>
                </th>
                <th>Durum</th>
                <th>İşlemler</th>
              </tr>
              <tr>
                <th>
                  <p-columnFilter type="numeric" field="id" [showClearButton]="false"></p-columnFilter>
                </th>
                <th>
                  <!-- Resim sütunu için filtre eklemiyoruz -->
                </th>
                <th>
                  <p-columnFilter type="text" field="shelfNo" [showClearButton]="false"></p-columnFilter>
                </th>
                <th>
                  <p-columnFilter type="text" field="itemCode" [showClearButton]="false"></p-columnFilter>
                </th>
                <th>
                  <p-columnFilter type="text" field="batchCode" [showClearButton]="false"></p-columnFilter>
                </th>
                <th>
                  <p-columnFilter type="text" field="barcode" [showClearButton]="false"></p-columnFilter>
                </th>
                <th>
                  <p-columnFilter type="numeric" field="quantity" [showClearButton]="false"></p-columnFilter>
                </th>
                <th>
                  <p-columnFilter type="text" field="warehouse" [showClearButton]="false"></p-columnFilter>
                </th>
                <th>
                  <p-columnFilter type="text" field="warehouseTo" [showClearButton]="false"></p-columnFilter>
                </th>
                <th>
                  <p-columnFilter type="numeric" field="availableQty" [showClearButton]="false"></p-columnFilter>
                </th>
                <th>
                  <!-- Durum sütunu için filtre eklemiyoruz -->
                </th>
                <th>
                  <!-- İşlemler sütunu için filtre eklemiyoruz -->
                </th>
              </tr>
            </ng-template>
            <ng-template pTemplate="body" let-warehousePackageDetail let-a="rowIndex">
              <tr>
                <td>{{ a + 1 }}</td>
                <td>
                  <p-image src="{{ warehousePackageDetail.photoUrl }}" alt="Image" width="50" [preview]="true">
                  </p-image>
                </td>
                <td>{{ warehousePackageDetail.shelfNo }}</td>
                <td>{{ warehousePackageDetail.itemCode }}</td>
                <td>{{ warehousePackageDetail.batchCode }}</td>
                <td>{{ warehousePackageDetail.barcode }}</td>
                <td>{{ warehousePackageDetail.quantity }}</td>
                <td>{{ warehousePackageDetail.warehouse }}</td>
                <td>{{ warehousePackageDetail.warehouseTo }}</td>
                <td>{{ warehousePackageDetail.availableQty }}</td>
                <td>
                  <span [ngClass]="
                    warehousePackageDetail.availableQty >= warehousePackageDetail.quantity
                        ? 'badge badge-success'
                        : 'badge badge-danger'
                    ">
                    {{
                        warehousePackageDetail.availableQty >= warehousePackageDetail.quantity
                            ? 'Başarılı'
                            : 'Başarısız : Stok Hatası'
                    }}
                  </span>
                </td>
                <td>
                  <div class="btn-group">
                    <button class="btn btn-primary" type="submit"
                      (click)="deleteOrderProduct(currentOrderNo, warehousePackageDetail)">
                      <i class="fa fa-trash" aria-hidden="true"></i>
                    </button>
                    <button class="btn btn-primary" type="submit"
                      (click)="change(warehousePackageDetail.barcode, warehousePackageDetail.quantity)">
                      <i class="fa fa-print"></i>
                    </button>
                  </div>
                </td>
              </tr>
            </ng-template>
          </p-table>

        </div>
        <!-- Yeni kart: Toplanan Ürünler -->
        <div class="card text-center">
          <div class="card-body">
            <h5 class="card-title">Toplanan Ürünler</h5>
            <h1 class="display-1">{{ totalCount }}</h1>
            <p class="card-text">Adet Ürün Toplandı</p>
          </div>
        </div>
      </div>
    </div>

    <app-image-modal [imageUrl]="modalImageUrl" [title]="'Ürün Detay'"></app-image-modal>

    <p-dialog header="Header" [(visible)]="visible" [style]="{ width: '75vw' }">
      <app-create-qr [barcode]="_barcode" [quantity]="quantity"></app-create-qr>
    </p-dialog>

    <p-dialog header="Raflar" [(visible)]="productShelvesDialog">
      <div class="btn-group mr-2" role="group" aria-label="First group">
        <button *ngFor="let shelve of productShelves; let i = index" (click)="setShelveToForm(shelve)" type="button"
          [ngClass]="i % 2 === 0 ? 'btn btn-primary' : 'btn btn-secondary'" style="height: 10rem">
          {{ shelve }}
        </button>
      </div>
    </p-dialog>
    <p-dialog header="Ürün Eklenemedi" [(visible)]="blockedCount" [modal]="true" [style]="{ width: '50vw' }"
      [draggable]="false" [resizable]="false">
      <h1>{{ blockedCountReason }}</h1>
    </p-dialog>
  </section>
</main>
