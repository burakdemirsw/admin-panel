<main id="main" class="main">
  <!-- <ol class="breadcrumb">
    <li class="breadcrumb-item active">USD: {{ exchangeRate.usd }}</li>
    <li class="breadcrumb-item active">EUR:{{ exchangeRate.eur }}</li>
  </ol> -->
  <section class="section">
    <p-tabView id="closableTabView" [scrollable]="true" [(activeIndex)]="activeIndex">
      <!-- <p-tabPanel
        header="Satış Elemanı Seç"
        [rightIcon]="
          this.createCustomerForm.get('salesPersonCode').value
            ? 'pi pi-check'
            : 'pi pi-times'
        "
        [selected]="true"
      >
        <form [formGroup]="createCustomerForm">
          <p-dropdown [style]="{'width': '100%'}"
            formControlName="salesPersonCode"
            [options]="salesPersonModelList"
            [(ngModel)]="selectedPerson"
            optionLabel="name"
            [filter]="true"
          ></p-dropdown>
        </form>
        <div class="row mt-3">
          <p-button (onClick)="selectSalesPerson()">Ekle</p-button>
        </div>
      </p-tabPanel> -->
      <!-- <p-tabPanel
        header="Ofis Depo Seç"
        [rightIcon]="
          this.createCustomerForm.get('office').value
            ? 'pi pi-check'
            : 'pi pi-times'
        "
      >
        <form [formGroup]="createCustomerForm">
          <div class="row mb-3">
            <div class="col-md-6">
              <label for="office"> Ofis</label>
              <br />
              <p-dropdown [style]="{'width': '100%'}"
                formControlName="office"
                [options]="offices"
                optionLabel="name"
                [filter]="true"
              ></p-dropdown>
            </div>
            <div class="col-md-6">
              <label for="warehouse">Depo</label>
              <br />
              <p-dropdown [style]="{'width': '100%'}"
                formControlName="warehouse"
                [options]="warehouses"
                optionLabel="name"
                [filter]="true"
              ></p-dropdown>
            </div>
          </div>
        </form>
        <div class="row">
          <p-button
            (onClick)="selectOfficeAndWarehosue(createCustomerForm.value)"
            >Ekle</p-button
          >
        </div>
      </p-tabPanel> -->
      <p-tabPanel header="Ürün & Fiyat" [rightIcon]="
          this.selectedProducts.length > 0
            ? 'pi
        pi-check'
            : 'pi pi-times'
        ">


        <form [formGroup]="getProductsForm" (ngSubmit)="getProducts(this.getProductsForm.value, this.orderType)">
          <div class="row mb-3">

            <p-inputGroup>
              <input pInputText type="search" id="barcode_product" placeholder="Barkod" formControlName="barcode" />

              <input pInputText *ngIf="!this.orderType" type="search" id="shelfNo" placeholder="{{
                  shelfNumbers != 'RAFLAR:' ? shelfNumbers : 'Raf No'
                }}" formControlName="shelfNo" />


              <button pButton pRipple class="p-button-rounded p-button-text" icon="pi pi-plus" label="Ürün Ekle"
                type="submit"></button>
              <button pButton pRipple class="p-button-rounded p-button-text" icon="pi pi-search" label="Ürün Ara"
                type="button" (click)="getAllProducts()"></button>
              <button pButton pRipple class="p-button-rounded p-button-text" icon="pi pi-refresh" label="Muadil Bul"
                type="button" (click)="getsuggestedProducts(this.getProductsForm.value.barcode,true)"></button>
              <button pButton pRipple class="p-button-rounded p-button-text" (onClick)="resetProductForm()"
                icon="pi pi-trash" label="Barkodu Sil" type="reset"></button>
              <button pButton pRipple class="p-button-rounded p-button-text" (click)="deleteAllPRoduct()"
                icon="pi pi-trash" label="Formu Sil" type="button"></button>
            </p-inputGroup>


          </div>
        </form>
        <p-dialog header="Bulunan Ürünler" [(visible)]="findProductDialog" [style]="{ width: '100vw' }">
          <p-table [styleClass]="'p-datatable-striped'" [value]="allProducts" [paginator]="true" [rows]="10"
            (onFilter)="logFilteredData($event)" [tableStyle]="{ 'min-width': '50rem' }">


            <ng-template pTemplate="header">

              <tr>
                <th>Fotoğraf</th>
                <th pSortableColumn="brand">
                  Marka <p-sortIcon field="brand"></p-sortIcon>
                </th>

                <th pSortableColumn="itemCode">
                  Ürün Kodu <p-sortIcon field="itemCode"></p-sortIcon>
                </th>

                <th pSortableColumn="description">
                  Ürün <p-sortIcon field="description"></p-sortIcon>
                </th>
                <th pSortableColumn="productHierarchyLevel01">
                  Ürün Hiyerarşisi 1 <p-sortIcon field="productHierarchyLevel01"></p-sortIcon>
                </th>
                <th pSortableColumn="productHierarchyLevel02">
                  Ürün Hiyerarşisi 2 <p-sortIcon field="productHierarchyLevel02"></p-sortIcon>
                </th>
                <th pSortableColumn="productHierarchyLevel03">
                  Ürün Hiyerarşisi 3 <p-sortIcon field="productHierarchyLevel03"></p-sortIcon>
                </th>
                <th pSortableColumn="speed">
                  Hız <p-sortIcon field="speed"></p-sortIcon>
                </th>
                <th pSortableColumn="inventory">
                  Envanter <p-sortIcon field="inventory"></p-sortIcon>
                </th>
                <th pSortableColumn="price">
                  Fiyat <p-sortIcon field="price"></p-sortIcon>
                </th>
                <th>
                  İşlemler
                </th>
              </tr>
              <tr>
                <th></th>

                <th>
                  <p-columnFilter field="brand" matchMode="equals" [showMenu]="false">
                    <ng-template pTemplate="filter" let-value let-filter="filterCallback">
                      <p-dropdown virtualScroll="true" virtualScrollItemSize="50" [options]="brands"
                        (onChange)="filter($event.value)" placeholder="Seçiniz" [showClear]="true" filter="true"
                        filterBy="label">
                        <ng-template let-option pTemplate="item">
                          <span class="ml-1 mt-1">{{ option.label }}</span>
                        </ng-template>
                      </p-dropdown>
                    </ng-template>
                  </p-columnFilter>
                </th>
                <th>
                  <p-columnFilter field="itemCode" matchMode="equals" [showMenu]="false">
                    <ng-template pTemplate="filter" let-value let-filter="filterCallback">
                      <p-dropdown virtualScroll="true" virtualScrollItemSize="50" [options]="itemCodes"
                        (onChange)="filter($event.value)" placeholder="Seçiniz" [showClear]="true" filter="true"
                        filterBy="label">
                        <ng-template let-option pTemplate="item">
                          <span class="ml-1 mt-1">{{ option.label }}</span>
                        </ng-template>
                      </p-dropdown>
                    </ng-template>
                  </p-columnFilter>
                </th>

                <th>
                  <p-columnFilter field="description" matchMode="equals" [showMenu]="false">
                    <ng-template pTemplate="filter" let-value let-filter="filterCallback">
                      <p-dropdown virtualScroll="true" virtualScrollItemSize="50" [options]="descriptions"
                        (onChange)="filter($event.value)" placeholder="Seçiniz" [showClear]="true" filter="true"
                        filterBy="label">
                        <ng-template let-option pTemplate="item">
                          <span class="ml-1 mt-1">{{ option.label }}</span>
                        </ng-template>
                      </p-dropdown>
                    </ng-template>
                  </p-columnFilter>
                </th>
                <th>
                  <p-columnFilter field="productHierarchyLevel01" matchMode="equals" [showMenu]="false">
                    <ng-template pTemplate="filter" let-value let-filter="filterCallback">
                      <p-dropdown [options]="productHierarchyLevel01s" (onChange)="filter($event.value)"
                        placeholder="Seçiniz" [showClear]="true" filter="true" filterBy="label">
                        <ng-template let-option pTemplate="item">
                          <span class="ml-1 mt-1">{{ option.label }}</span>
                        </ng-template>
                      </p-dropdown>
                    </ng-template>
                  </p-columnFilter>
                </th>
                <th>
                  <p-columnFilter field="productHierarchyLevel02" matchMode="equals" [showMenu]="false">
                    <ng-template pTemplate="filter" let-value let-filter="filterCallback">
                      <p-dropdown virtualScroll="true" virtualScrollItemSize="50" [options]="productHierarchyLevel02s"
                        (onChange)="filter($event.value)" placeholder="Seçiniz" [showClear]="true" filter="true"
                        filterBy="label">
                        <ng-template let-option pTemplate="item">
                          <span class="ml-1 mt-1">{{ option.label }}</span>
                        </ng-template>
                      </p-dropdown>
                    </ng-template>
                  </p-columnFilter>
                </th>
                <th>
                  <p-columnFilter field="productHierarchyLevel03" matchMode="equals" [showMenu]="false">
                    <ng-template pTemplate="filter" let-value let-filter="filterCallback">
                      <p-dropdown virtualScroll="true" virtualScrollItemSize="50" [options]="productHierarchyLevel03s"
                        (onChange)="filter($event.value)" placeholder="Seçiniz" [showClear]="true" filter="true"
                        filterBy="label">
                        <ng-template let-option pTemplate="item">
                          <span class="ml-1 mt-1">{{ option.label }}</span>
                        </ng-template>
                      </p-dropdown>
                    </ng-template>
                  </p-columnFilter>
                </th>
                <th>
                  <p-columnFilter type="numeric" field="speed" [showClearButton]="false"></p-columnFilter>
                </th>
                <th>
                  <p-columnFilter type="numeric" field="inventory" [showClearButton]="false"></p-columnFilter>
                </th>
                <th>
                  <p-columnFilter type="numeric" field="price" [showClearButton]="false"></p-columnFilter>
                </th>

              </tr>
            </ng-template>
            <ng-template pTemplate="body" let-product>
              <tr>

                <td>
                  <p-image src="{{ product.photoUrl }}" alt="Image" width="50" [preview]="true">
                  </p-image>
                </td>
                <td>{{ product.brand }}</td>

                <td>{{ product.itemCode }}</td>

                <td class="scrollable-td">{{ product.description }}</td>
                <td>{{ product.productHierarchyLevel01 }}</td>
                <td>{{ product.productHierarchyLevel02 }}</td>
                <td>{{ product.productHierarchyLevel03 }}</td>
                <td>{{ product.speed }}</td>
                <td>{{ product.inventory }}</td>
                <td>{{ product.price }}</td>
                <td>
                  <button pButton pRipple icon="pi pi-plus" type="button" class="p-button-rounded p-button-text "
                    (click)="addProduct(product)"></button>
                </td>
              </tr>
            </ng-template>
          </p-table>
        </p-dialog>

        <p-table [scrollable]="true" [value]="products" *ngIf="products.length > 0" styleClass="p-datatable-striped">
          <ng-template pTemplate="caption">
            Bulunan Ürünler
            {{
              this.products.length > 0
                ? " " + this.products.length + " Adet Ürün Bulundu"
                : ""
            }}
          </ng-template>

          <ng-template pTemplate="header">
            <tr>
              <th scope="col">Resim</th>
              <th scope="col">Ürün Kodu</th>
              <th scope="col">UD Stok</th>
              <th scope="col">MD Stok</th>
              <th scope="col">Miktar</th>
              <th scope="col">Barkod</th>

              <th scope="col">Satış Fiyatı</th>
              <th scope="col">Ürün Adı</th>
            </tr>
          </ng-template>
          <ng-template pTemplate="body" let-product>
            <tr [pEditableRow]="product">
              <td class="image-icon-td">
                <p-image src="{{ product.photoUrl }}" alt="Image" width="50" [preview]="true"></p-image>
              </td>

              <td>{{ product.itemCode }}</td>

              <td>{{ product.uD_Stock }}</td>
              <td>{{ product.mD_Stock }}</td>
              <td>
                {{ product.quantity }}
              </td>
              <td>{{ product.barcode }}</td>

              <td>
                {{ product.price | currency : "₺" }}
              </td>
              <td>{{ product.description.substring(0,50)}}</td>
            </tr>
          </ng-template>
        </p-table>

        <div class="mb-3"></div>

        <p-table #dt1 [scrollable]="true" [value]="selectedProducts" *ngIf="this.selectedProducts.length > 0"
          editMode="row" styleClass="p-datatable-striped" dataKey="lineId">
          <ng-template pTemplate="caption">
            Seçilen Ürünler
            {{
              this.products.length > 0
                ? " " + this.selectedProducts.length + " Adet Ürün Eklendi"
                : ""
            }}</ng-template>

          <ng-template pTemplate="header" let-editing="editing">
            <tr>
              <th scope="col">Resim</th>
              <th scope="col">İşlem</th>
              <th scope="col">Kod</th>

              <th *ngIf="!this.orderType" scope="col">Raf</th>
              <th *ngIf="!this.orderType" scope="col">Parti</th>

              <th scope="col">Miktar</th>
              <th scope="col">Birim Fiyat</th>
              <th scope="col">Toptan Fiyat</th>
              <th scope="col">İndirimli Fiyatı</th>
              <th scope="col">Toplam Fiyat</th>

              <th scope="col">Envanter</th>
              <th scope="col">Ürün</th>

              <th scope="col" style="cursor: pointer" (click)="deleteAllPRoduct()">
                Tümünü Sil
              </th>
            </tr>
          </ng-template>
          <ng-template pTemplate="body" let-product let-editing="editing" let-ri="rowIndex">
            <tr [pEditableRow]="product">
              <td class="image-icon-td">
                <p-image src="{{ product.photoUrl }}" alt="Image" width="50" [preview]="true"></p-image>
              </td>

              <td>
                <button pButton pRipple type="button" pInitEditableRow icon="pi pi-pencil"
                  (click)="openUpdateDialog(product,ri)" class="p-button-rounded p-button-text"></button>

              </td>

              <td>{{ product.itemCode }}</td>
              <td *ngIf="!this.orderType">{{ product.shelfNo }}</td>
              <td *ngIf="!this.orderType">{{ product.batchCode }}</td>

              <td style="cursor: pointer;" (click)="openUpdateDialog(product,ri)">
                {{ product.quantity }}
              </td>
              <td>
                {{ product.price | currency : "₺" }}
              </td>
              <td>
                {{ product.priceWs}}
              </td>
              <td style="cursor: pointer;" (click)="openUpdateDialog(product,ri)" class="hover-dark">
                {{ product.discountedPrice | currency : "₺" }}
              </td>

              <td>
                {{
                  product.price > product.discountedPrice
                    ? (product.discountedPrice * product.quantity
                      | currency : "₺")
                    : (product.price * product.quantity | currency : "₺")
                }}
              </td>
              <td>
                {{ product.uD_Stock + product.mD_Stock }}
              </td>


              <td class="scrollable-td">
                {{ product.description}}
              </td>

              <td>
                <button pButton pRipple icon="pi pi-trash" type="button"
                  class="p-button-rounded p-button-text p-button-danger" (click)="deleteProduct(product)"></button>
              </td>
            </tr>

            <style>
              .price-list-container {
                display: flex;
                flex-wrap: wrap;
                justify-content: center;
                gap: 1rem;
                padding: 1rem;
              }

              .price-item {
                flex: 1 1 calc(33.333% - 1rem);
                display: flex;
                justify-content: center;
                align-items: center;
              }

              .price-button {
                width: 100%;
                padding: 1rem;
                font-size: 1.2rem;

                transition: background-color 0.3s, border-color 0.3s;
              }

            </style>
            <p-dialog header="Stok Miktarı Yetersiz! Eğer Birinci Seçeneği Seçerseniz Eksik Gönderilcek Ürünler Olacaktır. İkince Seçenek Stoktaki Ürünler
            " [(visible)]="quantityListDialog" [style]="{ width: '80vw' }" modal="true" [dismissableMask]="true">
              <div class="price-list-container">
                <div *ngFor="let quantity of quantityList" class="price-item">
                  <button (click)="selectQuantity(product,ri,quantity)" pButton pRipple icon="pi pi-check"
                    class="p-button-rounded p-button-text price-button" type="button">{{quantity}}</button>
                </div>
              </div>

              <p-table [scrollable]="true" [value]="suggestedProducts" styleClass="p-datatable-striped"
                *ngIf="suggestedProducts.length>0">
                <ng-template pTemplate="header">
                  <tr>
                    <th>Aranan Ürün Kodu</th>
                    <th>Muadil Ürün Kodu</th>
                    <th>Envanter</th>
                    <th>İşlemler</th>
                  </tr>
                </ng-template>
                <ng-template pTemplate="body" let-product>
                  <tr>
                    <td>{{ product?.itemCode }}</td>
                    <td>{{ product?.suggestedItemCode }}</td>
                    <td>{{ product?.suggestedItemInventory }}</td>

                    <td>
                      <button pButton pRipple class="p-button-rounded p-button-text" icon="pi pi-plus"
                        (click)="routeGetProduct( product?.suggestedItemCode)" type="submit"></button>
                    </td>
                  </tr>
                </ng-template>
              </p-table>
              <h5 *ngIf="suggestedProducts.length<=0">Muadil Ürün Bulunamamıştır</h5>
            </p-dialog>
          </ng-template>
        </p-table>
        <p-dialog header="Muadil Ürün" [(visible)]="suggestedProductsDialog" [modal]="true" [closable]="true"
          [style]="{ width: '80vw' }">
          <p-table [scrollable]="true" [value]="suggestedProducts" styleClass="p-datatable-striped"
            *ngIf="suggestedProducts.length>0">
            <ng-template pTemplate="header">
              <tr>
                <th>Aranan Ürün Kodu</th>
                <th>Muadil Ürün Kodu</th>
                <th>Envanter</th>
                <th>İşlemler</th>
              </tr>
            </ng-template>
            <ng-template pTemplate="body" let-product>
              <tr>
                <td>{{ product?.itemCode }}</td>
                <td>{{ product?.suggestedItemCode }}</td>
                <td>{{ product?.suggestedItemInventory }}</td>

                <td>
                  <button pButton pRipple class="p-button-rounded p-button-text" icon="pi pi-plus"
                    (click)="routeGetProduct( product?.suggestedItemCode)" type="submit"></button>
                </td>
              </tr>
            </ng-template>
          </p-table>
        </p-dialog>

        <p-dialog header="Ürün Güncelle" [(visible)]="updateProductDialog" [modal]="true" [closable]="false"
          [style]="{width: '300px'}">
          <form [formGroup]="updateProductForm">
            <div class="p-fluid">
              <div class="p-field">
                <label for="price">Fiyat</label>
                <input id="price" type="number" pInputText formControlName="price">
              </div>
              <div class="p-field mb-3">
                <label for="quantity">Adet</label>
                <input id="quantity" type="number" pInputText formControlName="quantity">
              </div>
              <div class="p-field mb-3">
                <button type="button" pButton label="Güncelle"
                  (click)="onRowEditSave(this.selectedProduct,this.selectedIndex)"></button>
              </div>

              <div class="p-field">
                <button type="button" pButton label="Kapat" (click)="this.updateProductDialog =false"></button>
              </div>
            </div>
          </form>
        </p-dialog>


        <div class="mb-3"></div>

        <form [formGroup]="discountForm" *ngIf="selectedProducts.length > 0">
          <div class="row">
            <div class="col-md-6">
              <div class="input-group mb-3">
                <div class="input-group-prepend">
                  <button pButton pRipple icon="pi pi-check" class="p-button-rounded p-button-text" (click)="
                      discount(this.discountForm.value.percentDiscountRate)
                    " type="button"></button>
                </div>
                <input type="number" class="form-control" id="percentDiscountRate" placeholder="Yüzde İndirim Oranı"
                  formControlName="percentDiscountRate" (keydown.enter)="
                    discount(this.discountForm.value.percentDiscountRate)
                  " />
              </div>
            </div>
          </div>
          <p *ngIf="this.discountForm.value.percentDiscountRate">
            Uygulanan İndirim Oranı
            <span style="color: red">
              %{{ this.discountForm.value.percentDiscountRate }}
            </span>
          </p>
          <div class="row mb-3" #iskonto>
            <div class="col-md-6">
              <div class="input-group mb-3">
                <div class="input-group-append">
                  <button pButton pRipple class="p-button-rounded p-button-text" icon="pi pi-check" (click)="
                      cashDiscount(this.discountForm.value.cashDiscountRate)
                    " type="button"></button>
                </div>
                <input type="number" class="form-control" id="cashDiscountRate" placeholder="Nakit İndirim Tutarı"
                  formControlName="cashDiscountRate" (keydown.enter)="
                    cashDiscount(this.discountForm.value.cashDiscountRate)
                  " />
              </div>
            </div>
          </div>
          <p *ngIf="this.discountForm.value.cashDiscountRate">
            Uygulanan Nakit İndirim Tutarı
            <span style="color: red">
              ₺{{ this.discountForm.value.cashDiscountRate }}</span>
          </p>
          <div class="row mb-3">
            <div class="col-md-6">
              <button pButton pRipple style="width: 100%" class="p-button p-button-text" label="İndirimi Sıfırla"
                (click)="resetDiscount()" type="button"></button>
            </div>
          </div>
        </form>

        <div class="row mb-3">
          <div class="col-md-12 mt-3">
            <div *ngIf="selectedProducts.length > 0">
              <h1>TOPLAM : {{ getTotalPrice() | currency : "₺" }}</h1>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-md">
            <button *ngIf="this.selectedProducts.length > 0" pButton pRipple style="width: 100%"
              class="p-button-success" label="Müşteri Bul" (click)="goToPage(1)" type="submit"></button>
          </div>
        </div>
      </p-tabPanel>

      <p-tabPanel header="Müşteri" [rightIcon]="this.currAccCode ? 'pi pi-check' : 'pi pi-times'">
        <p-tabView>
          <p-tabPanel header="Müşteri Bul">
            <div class="row mb-3" *ngIf="this.invoiceType != undefined">
              <div class="col-md-1">
                <button pButton pRipple class="p-button-rounded p-button-text" label="Geri"
                  (click)="changeInvoiceType(undefined)" type="submit" icon="pi pi-arrow-left"></button>
              </div>
            </div>
            <div class="container mt-5" *ngIf="invoiceType ==undefined">
              <div class="row">
                <div class="col-md-6 mb-3">
                  <div class="card text-center card-hover" (click)="changeInvoiceType(true)">
                    <div class="card-body">
                      <h5 class="card-title">Kendime Fatura Kesilecek <i class="fas fa-booth-curtain    "></i></h5>
                      <i class="fas fa-person fa-3x"></i>
                    </div>
                  </div>
                </div>
                <div class="col-md-6 mb-3">
                  <div class="card text-center card-hover" (click)="changeInvoiceType(false)">
                    <div class="card-body">
                      <h5 class="card-title">Doktora Fatura Kesilcek</h5>
                      <i class="fas fa-user-md fa-3x"></i>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="row mb-3">
              <div class="col-md-12" *ngIf="invoiceType==false">
                <h3>MÜŞTERİ {{ selectedCustomers.length > 0 ? ' - ' + selectedCustomers[0]?.currAccDescription : '' }}
                </h3>
                <hr />
                <form [formGroup]="createCustomerForm" (ngSubmit)="submitAddressForm(createCustomerForm.value)">
                  <div class="row mb-3">
                    <div class="col-md-6">
                      <p-dropdown [virtualScroll]="true" [itemSize]="50" [style]="{'width': '100%'}"
                        #currAccDescription_dropdown optionLabel="name" filter="true" filterBy="name"
                        formControlName="currAccDescription" [options]="_selectableCustomers" placeholder="Müşteri"
                        [showClear]="true" (onChange)="onDropdownChange($event.value)" [filterFunction]="customFilter">
                      </p-dropdown>

                    </div>
                  </div>



                  <div class="row mb-3" *ngIf="false">
                    <div class="col-md-6">
                      <input pInputText placeholder="Telefon Numarası *" type="text" class="form-control"
                        id="phoneNumber" placeholder="(05XX XXX XX XX)" formControlName="phoneNumber" />
                    </div>
                  </div>
                </form>

                <form [formGroup]="createCustomerForm" *ngIf="false">
                  <div class="row">
                    <button pButton pRipple class="p-button-rounded p-button-text" icon="pi pi-plus" label="Detaylar"
                      type="button" (click)="isCollapsed = !isCollapsed"></button>
                  </div>
                  <div *ngIf="isCollapsed">
                    <div class="row mb-3" *ngIf="this.createCustomerForm.value.stampPhotoUrl">
                      <p-image src="{{ this.createCustomerForm.value.stampPhotoUrl }}" alt="Image" width="350"
                        [preview]="true" />
                    </div>
                    <div class="row" *ngIf="!this.createCustomerForm.value.stampPhotoUrl">
                      <div class="col-md-3">
                        <div class="input-group mb-3">
                          <div class="fileUpload">
                            <input type="file" class="upload" id="inputGroupFile01"
                              aria-describedby="inputGroupFileAddon01" (change)="onUpload($event, 'stampPhotoUrl')" />
                            <span> <i class="fas fa-camera"></i></span>
                          </div>
                        </div>
                      </div>

                      <div class="col-md-3">
                        <div class="form-group">
                          <input pInputText placeholder="Kaşe Fotoğraf Yolu" type="text" class="form-control"
                            style="width: 100%" id="stampPhotoUrl" formControlName="stampPhotoUrl" />
                        </div>
                      </div>
                    </div>
                    <div class="row mb-3" *ngIf="this.createCustomerForm.value.bussinesCardPhotoUrl">
                      <p-image src="{{
                          this.createCustomerForm.value.bussinesCardPhotoUrl
                        }}" alt="Image" width="350" [preview]="true" />
                    </div>
                    <div class="row" *ngIf="
                        !this.createCustomerForm.value.bussinesCardPhotoUrl
                      ">
                      <div class="col-md-3">
                        <div class="input-group mb-3">
                          <div class="fileUpload">
                            <input type="file" class="upload" id="inputGroupFile01"
                              aria-describedby="inputGroupFileAddon01" (change)="
                                onUpload($event, 'bussinesCardPhotoUrl')
                              " />
                            <span> <i class="fas fa-camera"></i></span>
                          </div>
                        </div>
                      </div>
                      <div class="col-md-3">
                        <input type="text" pInputText placeholder="Kartvizit Fotoğraf Yolu" class="form-control"
                          id="bussinesCardPhotoUrl" placeholder="Kartvizit Fotoğraf Yolu"
                          formControlName="bussinesCardPhotoUrl" />
                      </div>
                    </div>

                    <div class="row mb-3" *ngIf="this.createCustomerForm.value.cargoAddressPhotoUrl">
                      <p-image src="{{
                          this.createCustomerForm.value.cargoAddressPhotoUrl
                        }}" alt="Image" width="350" [preview]="true" />
                    </div>

                    <div class="row" *ngIf="
                        !this.createCustomerForm.value.cargoAddressPhotoUrl
                      ">
                      <div class="col-md-3">
                        <div class="input-group mb-3">
                          <div class="fileUpload">
                            <input type="file" class="upload" id="inputGroupFile01"
                              aria-describedby="inputGroupFileAddon01" (change)="
                                onUpload($event, 'cargoAddressPhotoUrl')
                              " />
                            <span> <i class="fas fa-camera"></i></span>
                          </div>
                        </div>
                      </div>

                      <div class="col-md-3">
                        <div class="form-group">
                          <input pInputText placeholder="Kargo Adres Fotoğraf Yolu" type="text" class="form-control"
                            style="width: 100%" id="cargoAddressPhotoUrl" formControlName="cargoAddressPhotoUrl" />
                        </div>
                      </div>
                    </div>
                    <div class="row mb-3">
                      <div class="col-md-6">
                        <label for="exampleInputEmail1">Mail</label>
                        <input type="text" class="form-control" id="mail" placeholder="Mail" formControlName="mail" />
                      </div>
                    </div>

                    <div class="row">
                      <div class="col-md-6">
                        <div class="form-group">
                          <label for="address_country" class="label">Ülke</label>
                          <select class="form-select" id="address_country" formControlName="address_country"
                            class="form-control">
                            <!-- Üst Kategori Seçenekleri Buraya Gelecek  -->
                            <option *ngFor="let country of _countries" value="{{ country.code }}">
                              {{ country.name }}
                            </option>
                          </select>
                        </div>
                      </div>
                    </div>

                    <div class="row">
                      <div class="col-md-6">
                        <div class="form-group">
                          <label for="address_region" class="label">Bölge</label>
                          <select class="form-select" id="address_region" formControlName="address_region"
                            class="form-control">
                            <!-- Üst Kategori Seçenekleri Buraya Gelecek  -->
                            <option *ngFor="let region of _regions" value="{{ region.code }}">
                              {{ region.name }}
                            </option>
                          </select>
                        </div>
                      </div>
                    </div>

                    <div class="row">
                      <div class="col-md-6">
                        <div class="form-group">
                          <label for="address_province" class="label">il</label>
                          <select class="form-select" id="address_province" formControlName="address_province">
                            <!-- Üst Kategori Seçenekleri Buraya Gelecek  -->
                            <option *ngFor="let province of _provinces" value="{{ province.code }}">
                              {{ province.name }}
                            </option>
                          </select>
                        </div>
                      </div>
                    </div>

                    <div class="row">
                      <div class="col-md-6">
                        <div class="form-group">
                          <label for="address_district" class="label">Vergi Dairesi</label>
                          <select class="form-select" id="address_taxOffice" formControlName="address_taxOffice">
                            <!-- Üst Kategori Seçenekleri Buraya Gelecek  -->
                            <option *ngFor="let taxOffice of _taxOffices" value="{{ taxOffice.code }}">
                              {{ taxOffice.name }}
                            </option>
                          </select>
                        </div>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-md-6">
                        <div class="form-group">
                          <label for="address_district" class="label">ilçe</label>
                          <select class="form-select" id="address_district" formControlName="address_district">
                            <!-- Üst Kategori Seçenekleri Buraya Gelecek  -->
                            <option *ngFor="let district of _districts" value="{{ district.code }}">
                              {{ district.name }}
                            </option>
                          </select>
                        </div>
                      </div>
                    </div>

                    <div class="row">
                      <div class="col-md-6">
                        <div class="form-group">
                          <label for="address_description" class="label">Adres (ZORUNLUDUR)</label>
                          <input type="text" class="form-control" id="address_description" name="address_description"
                            fullWidth formControlName="address_description" />
                        </div>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-md-6">
                        <div class="form-group mb-3">
                          <label for="address_postalCode" class="label">Posta Kodu</label>
                          <input type="text" id="address_postalCode" name="address_postalCode" fullWidth
                            formControlName="address_postalCode" class="form-control" />
                        </div>
                      </div>
                    </div>
                  </div>

                  <div class="row mb-3">
                    <div class="col-md-6">
                      <div class="form-group">
                        <button pButton pRipple class="p-button-rounded p-button-text" icon="pi pi-plus" type="submit"
                          style="width: 100%" label="Müşteri Ekle" [disabled]="selectedCustomers.length > 0"
                          (click)="submitAddressForm(createCustomerForm.value)"></button>

                      </div>
                    </div>
                  </div>
                </form>
              </div>
            </div>
            <div class="row mb-3" *ngIf="invoiceType==true">
              <div class="col-md-12">
                <h3>ALT MÜŞTERİ</h3>
                <hr />
                <form [formGroup]="createCustomerForm">
                  <p-inputGroup>
                    <p-inputGroupAddon>
                      <!-- <button pButton pRipple icon="pi pi-eye" class="p-button-rounded p-button-text" type="button"
      (click)=" this.subCustomerDialog = !this.subCustomerDialog "></button> -->
                      <p-dropdown [virtualScroll]="true" [itemSize]="50" [style]="{'width': '50%'}"
                        #subCurrAccDescription_dropdown formControlName="sc_Description" (click)="showPanel(3)"
                        [options]="selectableSubCustomers" placeholder="Müşteri" [editable]="true" optionLabel="name"
                        [showClear]="true" filterBy="name" filter="true">
                      </p-dropdown>

                    </p-inputGroupAddon>
                    <button pButton pRipple icon="pi pi-search" class="p-button-rounded p-button-text" type="button"
                      (click)="getSubCustomers()"></button>


                  </p-inputGroup>

                  <div class="mt-3 mb-3">
                    <button label="Yeni Alt Müşteri Oluştur" pButton pRipple icon="pi pi-plus"
                      class="p-button-rounded p-button-text" type="button"
                      (click)="openDialog('addSubCustomerDialog')"></button>
                  </div>
                </form>
              </div>
            </div>


          </p-tabPanel>
          <p-tabPanel header="Var Olan Müşteri">
            <form [formGroup]="getCustomerForm" class="customer-form"
              (ngSubmit)="getCustomers(this.getCustomerForm.value)">
              <div class="input-group mb-3">

                <input pInputText type="search" class="form-control" id="currAccCode" placeholder="Müşteri  Adı"
                  formControlName="currAccCode" />
                <span class="input-group-text"><i class="bi bi-card-checklist"></i></span>
              </div>
            </form>

            <p-dialog header="Bulunan Adresler" [(visible)]="selectAddressDialog" [style]="{ width: '80vw' }">
              <p-table [scrollable]="true" [value]="addresses" styleClass="p-datatable-striped">
                <ng-template pTemplate="header">
                  <tr>
                    <th>İl</th>
                    <th>İlçe</th>
                    <th>Adres</th>
                    <th>İşlemler</th>
                  </tr>
                </ng-template>
                <ng-template pTemplate="body" let-address>
                  <tr>
                    <td>{{ address.cityDescription }}</td>
                    <td>{{ address.districtDescription }}</td>
                    <td>{{ address.address.substring(0, 20) }}</td>
                    <td>
                      <button pButton pRipple class="p-button-rounded p-button-text" icon="pi pi-plus"
                        (click)="selectCurrentAddress(address)" type="submit"></button>
                    </td>
                  </tr>
                </ng-template>
              </p-table>
            </p-dialog>
            <div class="mb-3"></div>
            <p-table [scrollable]="true" [value]="customers" *ngIf="customers.length > 0"
              styleClass="p-datatable-striped">
              <ng-template pTemplate="header">
                <tr>
                  <th>Müşteri Kodu</th>
                  <th>Müşteri</th>

                  <th>Telefon</th>
                  <th>İşlemler</th>
                </tr>
              </ng-template>
              <ng-template pTemplate="body" let-customer>
                <tr>
                  <td (click)="selectCurrentCustomer(customer)">
                    {{ customer.currAccCode }}
                  </td>
                  <td (click)="selectCurrentCustomer(customer)">
                    {{ customer.currAccDescription }}
                  </td>
                  <td (click)="selectCurrentCustomer(customer)">
                    {{ customer.phone }}
                  </td>
                  <td>
                    <button pButton pRipple class="p-button-rounded p-button-text" icon="pi pi-plus"
                      (click)="selectCurrentCustomer(customer)"></button>
                  </td>
                </tr>
              </ng-template>
            </p-table>
          </p-tabPanel>
          <p-tabPanel header="Adres Ekle">
            <div *ngIf="this.selectedCustomers.length > 0">
              <form [formGroup]="_createCustomerForm" (ngSubmit)="_submitAddressForm(_createCustomerForm.value)">
                <div class="row">
                  <div class="col-md-6 form-group mb-3">
                    <p-dropdown [style]="{'width': '100%'}" [filter]="true" filterBy="name" id="address_country"
                      formControlName="address_country" [options]="_countries" optionLabel="name"
                      placeholder="Ülke Seçiniz"></p-dropdown>
                  </div>
                </div>

                <div class="row">
                  <div class="col-md-6 form-group mb-3">
                    <p-dropdown [style]="{'width': '100%'}" [filter]="true" filterBy="name" id="address_region"
                      formControlName="address_region" [options]="_regions" optionLabel="name"
                      placeholder="Bölge Seçiniz"></p-dropdown>
                  </div>
                </div>
                <div class="row">
                  <div class="col-md-6 form-group mb-3">
                    <p-dropdown [style]="{'width': '100%'}" [filter]="true" filterBy="name" id="address_province"
                      formControlName="address_province" [options]="_provinces" optionLabel="name"
                      placeholder="İl Seçiniz"></p-dropdown>
                  </div>
                </div>
                <div class="row">
                  <div class="col-md-6 form-group mb-3">
                    <p-dropdown [style]="{'width': '100%'}" [filter]="true" filterBy="name" id="address_taxOffice"
                      formControlName="address_taxOffice" [options]="_taxOffices" optionLabel="name"
                      placeholder="Vergi Dairesi Seçiniz"></p-dropdown>
                  </div>
                </div>
                <div class="row">
                  <div class="col-md-6 form-group mb-3">
                    <p-dropdown [style]="{'width': '100%'}" [filter]="true" filterBy="name" id="address_district"
                      formControlName="address_district" [options]="_districts" optionLabel="name"
                      placeholder="İlçe Seçiniz"></p-dropdown>
                  </div>
                </div>

                <div class="row">
                  <div class="col-md-6 form-group mb-3">
                    <input pInputText placeholder="Adres  *" type="text" class="form-control" id="address_description"
                      name="address_description" fullWidth formControlName="address_description" />
                  </div>
                </div>

                <div class="row">
                  <div class="col-md-6 form-group mb-3">
                    <input pInputText class="form-control" placeholder="Posta Kodu *" type="text"
                      id="address_postalCode" name="address_postalCode" fullWidth
                      formControlName="address_postalCode" />
                  </div>
                </div>

                <div class="col-md-6 form-group mb-3">
                  <button pButton pRipple class="p-button-success" style="width: 100%" label="Etiket Çıkart"
                    type="submit" label="Kaydet"></button>
                </div>
              </form>
            </div>
          </p-tabPanel>
        </p-tabView>
        <p-dialog header="Alt Müşteriler" [(visible)]="subCustomerDialog" [style]="{ width: '80vw' }">
          <p-table [scrollable]="true" [value]="subCustomers" styleClass="p-datatable-striped">
            <ng-template pTemplate="header">
              <tr>
                <th>Müşteri Kodu</th>
                <th>Müşteri</th>
                <th>Adres</th>
                <th>İşlemler</th>
              </tr>
            </ng-template>
            <ng-template pTemplate="body" let-subCustomer>
              <tr>
                <td>{{ subCustomer?.currAccCode }}</td>
                <td>{{ subCustomer?.companyName }}</td>
                <td>{{ subCustomer?.city + ' / ' + subCustomer?.district + ' / ' + subCustomer?.address }}</td>

                <td>
                  <button pButton pRipple class="p-button-rounded p-button-text" icon="pi pi-plus"
                    (click)="selectCurrentSubCustomer(subCustomer)" type="submit"></button>
                </td>
              </tr>
            </ng-template>
          </p-table>
        </p-dialog>

        <p-dialog header="Alt Müşteri Ekle" [(visible)]="addSubCustomerDialog" [style]="{ width: '100vw' }">
          <form [formGroup]="addSubCustomerForm">
            <div class="row mb-3">
              <div class="form-group">
                <input pInputText class="form-control" type="text" placeholder="Alt Müşteri" id="subCurrAccDesc"
                  name="subCurrAccDesc" fullWidth formControlName="subCurrAccDesc" />
              </div>
            </div>
            <div class="row mb-3">
              <div class="form-group">
                <input pInputText class="form-control" type="text" placeholder="Telefon" id="phone" name="phone"
                  fullWidth formControlName="phone" />
              </div>
            </div>
            <div class="row mb-3">
              <div class="form-group">
                <input pInputText class="form-control" type="text" placeholder="Mail" id="mail" name="mail" fullWidth
                  formControlName="mail" />
              </div>
            </div>
            <div class="row mb-3">
              <div class="col-md-6">
                <div class="form-group">
                  <input pInputText placeholder="Kaşe Fotoğraf Yolu" type="text" class="form-control"
                    style="width: 100%" id="stampPhotoUrl" formControlName="stampPhotoUrl" hidden />
                </div>
                <div class="input-group mb-3">
                  <div class="fileUpload">
                    <input type="file" class="upload" id="inputGroupFile01" aria-describedby="inputGroupFileAddon01"
                      (change)="onUpload($event, 'stampPhotoUrl')" />
                    <span> <i class="fas fa-camera"></i></span>
                  </div>
                </div>
              </div>

              <div class="col-md-6">
                <div class="form-group">
                  <input type="text" pInputText placeholder="Kartvizit Fotoğraf Yolu" class="form-control"
                    id="bussinesCardPhotoUrl" formControlName="bussinesCardPhotoUrl" hidden />
                </div>
                <div class="input-group mb-3">
                  <div class="fileUpload">
                    <input type="file" class="upload" id="inputGroupFile01" aria-describedby="inputGroupFileAddon01"
                      (change)="onUpload($event, 'bussinesCardPhotoUrl')" />
                    <span> <i class="fas fa-camera"></i></span>
                  </div>
                </div>
              </div>
            </div>

            <div class="row mb-3" *ngIf="this.addSubCustomerForm.value.stampPhotoUrl">
              <div class="col-md-6">
                <div class="row mb-3">
                  <p-image [appendTo]="'body'" src="{{ this.addSubCustomerForm.value.stampPhotoUrl }}" alt="Image"
                    width="100%" height="100%" [preview]="true" />
                </div>


              </div>

              <div class="col-md-6" *ngIf="this.addSubCustomerForm.value.bussinesCardPhotoUrl">
                <div class="row mb-3">
                  <p-image [appendTo]="'body'" src="{{ this.addSubCustomerForm.value.bussinesCardPhotoUrl }}"
                    alt="Image" width="100%" height="100%" [preview]="true" />
                </div>
              </div>
            </div>

            <div class="row mb-3">
              <button pButton pRipple class="p-button-rounded p-button-text" icon="pi pi-plus" label="Detaylar"
                type="button" (click)="isCollapsed_2 = !isCollapsed_2"></button>
            </div>



            <!-- <div class="row mb-3" *ngIf="this.addSubCustomerForm.value.cargoAddressPhotoUrl">
              <p-image src="{{
                          this.addSubCustomerForm.value.cargoAddressPhotoUrl
                        }}" alt="Image" width="350" [preview]="true" />
            </div>

            <div class="row" *ngIf="
                        !this.addSubCustomerForm.value.cargoAddressPhotoUrl
                      ">
              <div class="col-md-3">
                <div class="input-group mb-3">
                  <div class="fileUpload">
                    <input type="file" class="upload" id="inputGroupFile01" aria-describedby="inputGroupFileAddon01"
                      (change)="
                                onUpload($event, 'cargoAddressPhotoUrl')
                              " />
                    <span> <i class="fas fa-camera"></i></span>
                  </div>
                </div>
              </div>

              <div class="col-md-3">
                <div class="form-group">
                  <input pInputText placeholder="Kargo Adres Fotoğraf Yolu" type="text" class="form-control"
                    style="width: 100%" id="cargoAddressPhotoUrl" formControlName="cargoAddressPhotoUrl" />
                </div>
              </div>
            </div> -->


            <div *ngIf="isCollapsed_2">
              <div class="row mb-3">
                <div class=" form-group">
                  <p-dropdown [style]="{'width': '100%'}" [filter]="true" filterBy="name" id="country"
                    formControlName="country" [options]="_countries" optionLabel="name" placeholder="Ülke Seçiniz">
                  </p-dropdown>
                </div>
              </div>

              <div class="row  mb-3">
                <div class="form-group ">
                  <p-dropdown [style]="{'width': '100%'}" [filter]="true" filterBy="name" id="region"
                    formControlName="region" [options]="_regions" optionLabel="name" placeholder="Bölge Seçiniz">
                  </p-dropdown>
                </div>
              </div>
              <div class="row  mb-3">
                <div class=" form-group">
                  <p-dropdown [style]="{'width': '100%'}" [filter]="true" filterBy="name" id="province"
                    formControlName="province" [options]="_provinces" optionLabel="name" placeholder="İl Seçiniz">
                  </p-dropdown>
                </div>
              </div>

              <div class="row  mb-3">
                <div class="form-group">
                  <p-dropdown [style]="{'width': '100%'}" [filter]="true" filterBy="name" id="district"
                    formControlName="district" [options]="_districts" optionLabel="name" placeholder="İlçe Seçiniz">
                  </p-dropdown>
                </div>
              </div>
              <div class="row  mb-3">
                <div class=" form-group mb-3">
                  <p-dropdown [style]="{'width': '100%'}" [filter]="true" filterBy="name" id="taxOffice"
                    formControlName="taxOffice" [options]="_taxOffices" optionLabel="name"
                    placeholder="Vergi Dairesi Seçiniz"></p-dropdown>
                </div>
              </div>
              <div class="row  mb-3">
                <div class="form-group">
                  <input pInputText placeholder="Adres *" type="text" class="form-control" id="address" name="address"
                    fullWidth formControlName="address" />
                </div>
              </div>

            </div>


            <div class="row mb-3">
              <div class="form-group">
                <button pButton pRipple class="p-button-rounded p-button-text" icon="pi pi-plus" label="Ekle"
                  type="submit" (click)="addSubCustomer()"></button>
              </div>
            </div>

          </form>
        </p-dialog>
      </p-tabPanel>

      <p-tabPanel [rightIcon]="
          this.cargoForm.valid == true ? 'pi pi-check' : 'pi pi-times'
        " header="Kargo Oluştur">
        <div class="container mt-5" *ngIf="!showCargo2">
          <div class="row">
            <div class="col-md-6 mb-3">
              <div class="card text-center card-hover" (click)="showCargoForm(false)">
                <div class="card-body">
                  <h5 class="card-title">KENDİM ALACAĞIM</h5>
                  <i class="fas fa-shopping-cart fa-3x"></i>
                </div>
              </div>
            </div>
            <div class="col-md-6 mb-3">
              <div class="card text-center card-hover" (click)="showCargoForm(true)">
                <div class="card-body">
                  <h5 class="card-title">KARGOLU SİPARİŞ</h5>
                  <i class="fas fa-truck fa-3x"></i>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="row mb-3" *ngIf="showCargo2">
          <div class="col-md-1">
            <button pButton pRipple class="p-button-rounded p-button-text" label="Geri" (click)="goBack()" type="submit"
              icon="pi pi-arrow-left"></button>
          </div>
        </div>

        <form [formGroup]="cargoForm" *ngIf="this.showCargo2">
          <div class="row mb-3">
            <div class="col-md-6">
              <input pInputText placeholder="Klinik Kargo Sorumlusu/ Fatura-Sipariş Açıklaması" type="text"
                id="address_recepient_name" name="address_recepient_name" fullWidth
                formControlName="address_recepient_name" class="form-control" />
            </div>
          </div>
          <div class="row">
            <div class="col-md-6 form-group">
              <input pInputText placeholder="Alıcı Telefon Numarası" type="text" class="form-control"
                id="address_phoneNumber" name="address_phoneNumber" placeholder="(05XX XXX XX XX)" fullWidth
                formControlName="address_phoneNumber" />
              <!-- <p style="font-weight: bold">
                {{
                  this.cargoForm.get("address_phoneNumber")?.value === null ||
                  this.cargoForm.get("address_phoneNumber")?.value === ""
                    ? "Alıcı Telefonu Yoksa Satış Elemanı Telefonu ile Gönderim Yapılır"
                    : ""
                }}
              </p> -->
            </div>
          </div>

          <div class="row">
            <div class="col-md-6">
              <br />
              <p-dropdown [style]="{'width': '100%'}" placeholder="Kargo Şirketi Seçiniz" [filter]="true"
                filterBy="name" formControlName="cargoFirm" [options]="cargoFirms" optionLabel="name"
                placeholder=" Kargo Şirketi Seçiniz"></p-dropdown>
            </div>
          </div>
          <div class="row mb-3">
            <div class="col-md-6">
              <br />
              <p-dropdown [style]="{'width': '100%'}" placeholder="Paketleme Tipi Seçiniz" [filter]="true"
                filterBy="name" class="'ng-dirty ng-invalid'" formControlName="packagingType" [options]="packagingTypes"
                optionLabel="name" placeholder=" Paketleme Tipi Seçiniz"></p-dropdown>
            </div>
          </div>
          <div class="row mb-3">
            <div class="col-md-6">
              <p-panel header="KG & DESİ" *ngIf="
                  this.cargoForm.get('packagingType').value &&
                  this.cargoForm.get('packagingType').value?.code !== '1'
                ">
                <div class="row mb-3">
                  <div class="col-md">
                    <label for="kg"> Kg</label>
                    <br />
                    <input type="number" class="form-control" id="kg" placeholder="KG" formControlName="kg" />

                    <p>{{ kgErrorMessage }}</p>
                  </div>
                </div>

                <div class="row mb-3">
                  <div class="col-md">
                    <label for="desi"> Desi</label>
                    <br />
                    <input type="number" class="form-control" id="desi" placeholder="DESİ" formControlName="desi" />
                    <p>{{ desiErrorMessage }}</p>
                  </div>
                </div>
              </p-panel>
            </div>
          </div>

          <div class="row mb-3">
            <div class="col-md-6">
              <p-dropdown [style]="{'width': '100%'}" placeholder="Gönderim Türü Seçiniz" [filter]="true"
                filterBy="name" formControlName="shipmentServiceType" [options]="shipmentServiceTypes"
                optionLabel="name" placeholder="  Gönderim Türü Seçiniz"></p-dropdown>
            </div>
          </div>
          <div class="row mb-3">
            <div class="col-md-6">
              <p-dropdown [style]="{'width': '100%'}" [filter]="true" filterBy="name" formControlName="cargoPrice"
                [options]="cargoPrices" optionLabel="name" placeholder="Paket Fiyatlandırması Seçiniz"></p-dropdown>
            </div>
          </div>
          <div class="row mb-3">
            <div class="col-md-6 form-group mb-3">
              <input pInputText placeholder="Paket Adedi" type="number" class="form-control" id="address_package_count"
                name="address_package_count" fullWidth formControlName="address_package_count" />
              <p style="font-weight: bold" *ngIf="
                  cargoForm.get('address_package_count').value <
                  this.selectedProducts.length
                ">
                {{ "Seçilen Koli Adedi Ürün Sayısından Az Olamaz" }}
              </p>
            </div>
          </div>

          <div class="row mb-3">
            <div class="col-md-6">
              <label for="office"> Kapıda Ödeme?</label>
              <br />
              <p-inputSwitch formControlName="isCOD"></p-inputSwitch>
            </div>
          </div>

          <div class="row mb-3">
            <div class="col-md-6">
              <label for="isActive"> Kargolu Satış </label>
              <br />
              <p-inputSwitch formControlName="isActive"></p-inputSwitch>
            </div>
          </div>

          <div class="card" *ngIf="
              selectedCustomers?.length > 0 &&
              selectedAddresses?.length > 0 &&
              this.cargoForm.get('cargoFirm').value?.name === 'Aras'
            ">
            <div class="card-body" style="
                display: flex;
                justify-content: center;
                align-items: center;
                flex-direction: column;
                height: 100%;
              "></div>
          </div>
          <div class="row mb-3">
            <div class="col-md">
              <button *ngIf="this.cargoForm.valid" pButton pRipple style="width: 100%" class="p-button-success"
                label="Önizleme Sayfasına İlerle" (click)="goToPage(3)" type="submit"></button>
            </div>
          </div>
        </form>

        <!-- <form [formGroup]="cargoForm_2" *ngIf="showCargo2">
          <div class="row mb-3">
            <div class="col-md-6">
              <input
                pInputText
                placeholder="Klinik Kargo Sorumlusu/ Fatura-Sipariş Açıklaması"
                type="text"
                id="address_recepient_name"
                name="address_recepient_name"
                fullWidth
                formControlName="address_recepient_name"
                class="form-control"
              />
            </div>
          </div>
          <div class="row mb-3">
            <div class="col-md-6 form-group">
              <input
                pInputText
                placeholder="Alıcı Telefon Numarası"
                type="text"
                class="form-control"
                id="address_phoneNumber"
                name="address_phoneNumber"
                placeholder="(05XX XXX XX XX)"
                fullWidth
                formControlName="address_phoneNumber"
              />
            </div>
          </div>
          <div class="row mb-3">
            <div class="col-md-6">
              <button
                *ngIf="this.cargoForm_2.valid"
                pButton
                pRipple
                style="width: 100%"
                class="p-button-success"
                label="Önizleme Sayfasına İlerle"
                (click)="goToPage(3)"
                type="submit"
              ></button>
            </div>
          </div>
        </form>-->
      </p-tabPanel>

      <p-tabPanel header="Sipariş Önizleme">
        <div class="mb-3"></div>
        <div #ödemeler>
          <form [formGroup]="paymentForm">
            <div *ngIf="
                this.selectedCustomers.length > 0 &&
                this.selectedAddresses.length > 0
              ">
              <div class="row" #TAXFREE? *ngIf="
                  this.selectedCustomers.length > 0 &&
                  this.selectedAddresses.length > 0
                ">
                <div class="col-md-6 mb-3">
                  <p-dropdown [style]="{'width': '100%'}" [options]="stateOptions" optionLabel="label"
                    placeholder="Vergi Tipi Seçiniz" formControlName="taxTypeCode"></p-dropdown>
                </div>
                <div class="col-md-6 mb-3">
                  <p-dropdown [style]="{'width': '100%'}" [options]="paymentMethods" optionLabel="name"
                    placeholder="Ödeme Seçiniz" formControlName="paymentType"></p-dropdown>
                </div>
              </div>
              <div class="row">
                <div class="col-md-6 mb-3">
                  <input type="text" pInputText style="width: 100%" formControlName="orderDescription"
                    placeholder="Sipariş Açıklaması" />
                </div>
                <div class="col-md-3 mb-3">
                  <h5>Toplam(V.H) : ₺{{ getTotalPrice() }}</h5>
                </div>
                <div class="col-md-3 mb-3">
                  <h5 *ngIf="this.paymentForm.value.taxTypeCode?.value == '0'">
                    Kdv : ₺{{ getTotalPriceWithTax() }}
                  </h5>
                </div>
              </div>
              <div #SPRSONAYLA class="row">
                <div class="col-md-6 mb-3">
                  <button (click)="createOrder()" pButton pRipple style="width: 100%" label="Siparişi Onayla"
                    class="p-button-success"></button>
                </div>

                <div class="col-md-6">
                  <button pButton pRipple style="width: 100%" label="Sipariş İptal" class="p-button-danger"
                    (click)="deleteClientOrder()"></button>
                </div>
              </div>
            </div>
          </form>
        </div>

        <div class="mb-3"></div>

        <div class="table-wrapper selected-products-table" #ürünler>
          <p-table [scrollable]="true" [value]="selectedProducts" *ngIf="this.selectedProducts.length > 0"
            editMode="row" styleClass="p-datatable-striped" dataKey="lineId">
            <ng-template pTemplate="header" let-editing="editing">
              <tr>
                <th scope="col">Resim</th>
                <th scope="col">Kod</th>
                <th scope="col">Miktar</th>

                <th scope="col">Birim Fiyat</th>

                <th scope="col">İndirimli Fiyat</th>
                <th scope="col">Toplam Fiyat</th>
                <th scope="col">Ürün</th>
                <!--  <th scope="col">Ekle-Çıkar</th> -->
                <!-- <th scope="col">Sil</th> -->
              </tr>
            </ng-template>
            <ng-template pTemplate="body" let-product let-ri="rowIndex">
              <tr>
                <td class="image-icon-td">
                  <p-image src="{{ product.photoUrl }}" alt="Image" width="50" [preview]="true"></p-image>
                </td>

                <td>{{ product.itemCode }}</td>

                <td>
                  {{ product.quantity }}
                </td>

                <td>
                  {{ product.price | currency : "₺" }}
                </td>
                <td>{{ product.discountedPrice | currency : "₺" }}</td>

                <td>
                  {{
                    product.price > product.discountedPrice
                      ? (product.discountedPrice * product.quantity
                        | currency : "₺")
                      : (product.price * product.quantity | currency : "₺")
                  }}
                </td>
                <td>
                  {{ product.description.substring(0,50)}}
                </td>
              </tr>
            </ng-template>
          </p-table>
        </div>

        <!-- Create New Order Button -->
        <div class="mb-3"></div>
        <!-- <div class="card" #siparişNumarası>
          <div class="card-body text-center">
            <h1 class="mt-3"><i class="fa-regular fa-circle-check"></i></h1>

            <h5 class="mb-3">Sipariş Numaranız</h5>
            <h5 class="mb-3">{{ orderNumber }}</h5>
            <h2 class="mb-3">{{ orderNo }}</h2>
          </div>
        </div> -->

        <div class="mb-3"></div>
        <div class="row" style="display: flex" #kutular>
          <div class="col-md-4 mb-4">
            <div class="card" #card1 style="height: 100%" *ngIf="this.selectedCustomers.length > 0">
              <div class="card-body">
                <h5 class="card-title">Müşteri
                </h5>
                <!-- <p class="card-text">
                  Bayi Kodu:
                  {{
                    selectedCustomers[0].currAccCode
                      ? selectedCustomers[0].currAccCode
                      : this.currAccCode
                  }}
                </p> -->
                <p class="card-text">
                  Müşteri: {{ selectedCustomers[0]?.currAccDescription }}
                </p>
                <!-- <p class="card-text">Mail: {{ selectedCustomers[0].mail }}</p>
                <p class="card-text">
                  Telefon: {{ selectedCustomers[0].phone }}
                </p> -->
                <p class="card-text">
                  Para Birimi: {{ selectedCustomers[0]?.docCurrencyCode }}
                </p>

                <h5 class="card-title">Alt Müşteri</h5>
                <p class="card-text">
                  Alt Müşteri: {{ selectedSubCustomers[0]?.companyName }}
                </p>
                <p class="card-text">
                  Telefon: {{ selectedSubCustomers[0]?.phone }}
                </p>
                <p class="card-text">
                  Mail: {{ selectedSubCustomers[0]?.mail }}
                </p>
                <button class="btn btn-danger" (click)="deleteCurrentCustomer()">
                  Müşteriyi Sil
                </button>
              </div>
            </div>

            <div class="card" *ngIf="selectedCustomers.length <= 0" style="height: 100%">
              <div class="card-body text-center" (click)="this.activeIndex = 1" style="
                  cursor: pointer;
                  display: flex;
                  flex-direction: column;
                  align-items: center;
                  justify-content: center;
                ">
                <div class="d-flex flex-column align-items-center">
                  <h1 class="mt-3">
                    <i class="fa-regular fa-circle-xmark"></i>
                  </h1>

                  <h5 class="mb-3">Müşteri Seçiniz</h5>
                </div>
              </div>
            </div>
          </div>

          <div class="col-md-4 mb-4">
            <div class="card" style="height: 100%" #card2 *ngIf="selectedAddresses.length > 0">
              <div class="card-body">
                <p class="card-title">Adres</p>
                <p class="card-text">
                  Ülke: {{ this.selectedAddresses[0].countryDescription }}
                </p>
                <p class="card-text">
                  Bölge: {{ this.selectedAddresses[0].stateDescription }}
                </p>
                <p class="card-text">
                  İl: {{ this.selectedAddresses[0].cityDescription }}
                </p>
                <p class="card-text">
                  İlçe: {{ this.selectedAddresses[0].districtDescription }}
                </p>
                <p class="card-text">
                  Adres: {{ this.selectedAddresses[0].address }}
                </p>

                <p class="card-text">
                  Alıcı Adı:
                  {{ this.cargoForm.get("address_recepient_name").value }}
                </p>
                <button class="btn btn-danger" (click)="deleteCurrentAddress()">
                  Adresi Sil
                </button>
              </div>
            </div>

            <div class="card" *ngIf="selectedAddresses.length <= 0" style="
                cursor: pointer;
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                height: 100%;
              ">
              <div class="card-body text-center" (click)="this.activeIndex = 1" style="
                  cursor: pointer;
                  display: flex;
                  flex-direction: column;
                  align-items: center;
                  justify-content: center;
                ">
                <div class="d-flex flex-column align-items-center">
                  <h1 class="mt-3">
                    <i class="fa-regular fa-circle-xmark"></i>
                  </h1>

                  <h5 class="mb-3">Adresi Seçiniz</h5>
                </div>
              </div>
            </div>
          </div>
          <div class="col-md-4 mb-4" *ngFor="let value of selectedOfficeAndWarehosue">
            <div class="card" style="height: 100%">
              <div class="card-body">
                <h5 class="card-title">Sipariş Bilgileri</h5>
                <p class="card-subtitle mb-2 text-muted">
                  Ofis: {{ value.office }}
                </p>
                <p class="card-text">Depo: {{ value.warehouse }}</p>
                <p class="card-text">
                  Ödeme:
                  {{
                    payment.creditCardTypeCode === undefined
                      ? ""
                      : payment.creditCardTypeCode
                  }}
                </p>
                <p class="card-text">
                  Satış Elemanı:
                  {{
                    this.salesPersonCode === undefined
                      ? ""
                      : this.salesPersonCode
                  }}
                </p>

                <p class="card-text">
                  Paketleme Tipi:
                  {{ this.cargoForm.get("packagingType")?.value?.name }}
                </p>
                <p class="card-text">
                  Kapıda Ödeme :
                  {{
                    this.cargoForm.get("isCOD")?.value === true
                      ? "Evet"
                      : "Hayır"
                  }}
                </p>
                <p class="card-text">
                  Sipariş No:
                  {{ this.orderNo }}
                  {{ this.orderNumber != null ? "- " + this.orderNumber : "" }}
                </p>
              </div>
            </div>
          </div>
        </div>
        <button (click)="createNewOrder()" pButton pRipple style="width: 100%" label="Yeni Sipariş Oluştur"
          class="p-button-success"></button>
      </p-tabPanel>
    </p-tabView>
  </section>
</main>
