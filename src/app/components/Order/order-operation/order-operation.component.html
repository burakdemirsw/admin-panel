<main id="main" class="main">
  <section class="section">
    <div class="row">
      <div>
        <div class="card" *ngIf="_productsToCollect.length > 0">
          <p-table [value]="_productsToCollect" class="table" #bilgilendirmeAlanı [rows]="1"
            [tableStyle]="{ 'min-width': '50rem' }">
            <ng-template pTemplate="header">
              <tr>
                <th *ngFor="let header of tableHeaders">
                  {{ header }}
                </th>
              </tr>
            </ng-template>
            <ng-template pTemplate="body" let-product let-i="index">
              <tr [ngClass]="{ 'green-row': product.colorDescription == '1', 'success-row': product.quantity === 0 }">
                <td>
                  <p-image src="{{ product.photoUrl }}" previewImageSrc="{{ product.photoUrl }}" alt="Image" width="30"
                    [preview]="true"></p-image>
                </td>
                <td>{{ product.shelfNo }}</td>
                <td>{{ product.itemCode }}</td>
                <td>{{ product.itemDescription.substring(0, 30) }}</td>
                <td>{{ product.barcode }}</td>
                <td>{{ product.quantity }}</td>
                <td>{{ product.countedQty }}</td>
                <td>{{ product.colorDescription }}</td>
                <td>{{ product.itemDim1Code }}</td>
                <td>{{ product.currentQty }}</td>
                <td>
                  <div class="btn-group" role="group" aria-label="Basic example">
                    <button class="btn btn-primary" type="submit"
                      (click)="goDown2(product.barcode, product.shelfNo, product.itemCode)">
                      <i class="fa fa-angle-down"></i>
                    </button>
                    <button class="btn btn-primary" type="submit" data-toggle="tooltip" data-placement="right"
                      title="Raflar" (click)="getShelves(product.barcode)">
                      <i class="fa-solid fa-bars"></i>
                    </button>
                  </div>
                </td>
              </tr>
            </ng-template>
          </p-table>
        </div>
        <div div class="card text-center" *ngIf="productsToCollect.length <= 0">
          <div class="card-body">
            <h5 class="card-title">TÜM ÜRÜNLER TOPLANMIŞTIR</h5>

            <h1 class="display-1">
              <i class="fas fa-check-circle text-success" aria-hidden="true"></i>
            </h1>
            <p class="card-text" *ngIf="isInvoice">
              Bu Sipariş Toplanmıştır
            </p>
            <p style="cursor: pointer" class="card-title" routerLink="/create-cargo/{{ this.orderNo }}">
              Siparişi Kargolayabilirsiniz
            </p>
          </div>
        </div>

        <div class="card mobile">
          <div class="card-body">
            <h5 class="card-title">
              {{ pageDescription
              }}{{ customerName != undefined ? "-" + customerName : "" }}
            </h5>

            <form *ngIf="productsToCollect.length > 0 && this.user.useShelfWhenPickingOrders" class="mt-3"
              [formGroup]="checkForm" (ngSubmit)="onSubmit(checkForm.value)">
              <div class="row mb-3">
                <div class="form-group">
                  <div class="input-group">
                    <input pInputText placeholder="{{ shelfNumbers }}" type="text" id="shelfNo" class="form-control"
                      formControlName="shelfNo" (keydown.enter)="focusNextInput('barcode')" />
                    <div class="input-group-append">
                      <button type="button" style="height: 100%" (click)="clearShelfNumbers()" class="btn btn-primary">
                        <i class="fa-solid fa-broom"></i>
                      </button>
                    </div>
                  </div>
                </div>
                <!-- <label *ngIf="shelfNumbers !== 'RAFLAR:'" for="shelfNo">{{
                  shelfNumbers
                }}</label> -->
              </div>

              <div class="row mb-3">
                <div class="form-group">
                  <label *ngIf="qrBarcodeUrl !== null" for="qrBarcode">{{
                    qrBarcodeUrl
                  }}</label>
                  <input placeholder="Barkod" pInputText type="text" id="barcode" class="form-control"
                    formControlName="barcode" (keydown.enter)="onSubmit(checkForm.value)" />
                  <div class="input-group-append">
                    <!-- <button type="button" class="btn btn-primary">Camera</button> -->
                  </div>
                </div>
              </div>

              <div class="row mb-3">
                <div class="form-group col">
                  <div class="form-group">
                    <input pInputText type="number" placeholder="Miktar" id="quantity" class="form-control"
                      formControlName="quantity" />
                  </div>
                </div>

                <div class="form-group col">
                  <div class="form-group">
                    <input placeholder="Parti" pInputText type="text" id="batchCode" class="form-control"
                      formControlName="batchCode" />
                  </div>
                </div>
              </div>
            </form>
            <form *ngIf="productsToCollect.length > 0 && !this.user.useShelfWhenPickingOrders" class="mt-3"
              [formGroup]="checkForm2" (ngSubmit)="onSubmit2(checkForm2.value)">
              <div class="row mb-3">
                <div class="form-group">
                  <label *ngIf="qrBarcodeUrl !== null" for="qrBarcode">{{
                    qrBarcodeUrl
                  }}</label>
                  <input placeholder="Barkod" pInputText type="text" id="barcode" class="form-control"
                    formControlName="barcode" (keydown.enter)="onSubmit2(checkForm2.value)" />
                  <div class="input-group-append">
                    <!-- <button type="button" class="btn btn-primary">Camera</button> -->
                  </div>
                </div>
              </div>

              <div class="row mb-3">
                <div class="form-group col">
                  <div class="form-group">
                    <input pInputText type="number" placeholder="Miktar" id="quantity" class="form-control"
                      formControlName="quantity" />
                  </div>
                </div>

                <div class="form-group col">
                  <div class="form-group">
                    <input placeholder="Parti" pInputText type="text" id="batchCode" class="form-control"
                      formControlName="batchCode" />
                  </div>
                </div>
              </div>
            </form>
            <div class="row ">
              <div class="col-md-6 mb-3">
                <button [disabled]="this.productsToCollect.length <=  0" type="button" class="btn btn-primary"
                  style="width: 100%" (click)="onSubmit2(checkForm2.value)">
                  Ekle
                </button>
              </div>
              <div class="col-md-6">
                <button type="button" class="btn btn-primary" (click)="collectAndPack(this.collectedProducts)"
                  style="width: 100%">
                  {{ operation }}
                </button>
              </div>
            </div>
          </div>


        </div>

        <div class="card" *ngIf="productsToCollect.length > 0">
          <div class="card-body" style=" padding: 0px !important;">
            <h5 class="card-title " style="background-color: #f9fafb !important;padding: 20px;">Toplanacak Ürünler</h5>
            <p-table #dt2 [value]="productsToCollect" [(selection)]="selectedProducts" dataKey="itemCode"
              [paginator]="true" [rowsPerPageOptions]="[5, 10, 20]" [rows]="10" [tableStyle]="{ 'min-width': '50rem' }"
              currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries">
              <ng-template pTemplate="caption">
                <div class="p-4 card-body d-flex justify-content-start" style="overflow-x: auto">
                  <p-splitButton label="İşlemler" [model]="items" appendTo="body" />


                </div>
                <h5 *ngIf="selectedProducts.length > 0" style="text-align: left">
                  {{ selectedProducts.length }}/{{ productsToCollect.length }} Adet
                  Sipariş Seçildi
                </h5>
              </ng-template>
              <ng-template pTemplate="header">
                <tr>
                  <th>
                  </th>
                  <th></th> <!-- Fotoğraf için boş başlık -->
                  <th pSortableColumn="shelfNo">
                    Raf Numarası
                    <p-sortIcon field="shelfNo"></p-sortIcon>
                  </th>
                  <th pSortableColumn="itemCode">
                    Ürün Kodu
                    <p-sortIcon field="itemCode"></p-sortIcon>
                  </th>
                  <th pSortableColumn="itemDescription">
                    Ürün Açıklaması
                    <p-sortIcon field="itemDescription"></p-sortIcon>
                  </th>
                  <th pSortableColumn="barcode">
                    Barkod
                    <p-sortIcon field="barcode"></p-sortIcon>
                  </th>
                  <th pSortableColumn="quantity">
                    Miktar
                    <p-sortIcon field="quantity"></p-sortIcon>
                  </th>
                  <th pSortableColumn="countedQty">
                    Sayılan Miktar
                    <p-sortIcon field="countedQty"></p-sortIcon>
                  </th>
                  <th pSortableColumn="itemDim1Code">
                    Boyut Kodu
                    <p-sortIcon field="itemDim1Code"></p-sortIcon>
                  </th>
                  <th pSortableColumn="colorDescription">
                    Renk Açıklaması
                    <p-sortIcon field="colorDescription"></p-sortIcon>
                  </th>
                  <th pSortableColumn="currentQty">
                    Güncel Miktar
                    <p-sortIcon field="currentQty"></p-sortIcon>
                  </th>
                  <th>İşlemler</th>
                </tr>
                <tr>
                  <th style="width: 4rem">
                    <p-tableHeaderCheckbox></p-tableHeaderCheckbox>
                  </th>
                  <th></th> <!-- Fotoğraf için boş başlık -->
                  <th>
                    <p-columnFilter type="text" field="shelfNo" [showClearButton]="false"></p-columnFilter>
                  </th>
                  <th>
                    <p-columnFilter type="text" field="itemCode" [showClearButton]="false"></p-columnFilter>
                  </th>
                  <th>
                    <p-columnFilter type="text" field="itemDescription" [showClearButton]="false"></p-columnFilter>
                  </th>
                  <th>
                    <p-columnFilter type="text" field="barcode" [showClearButton]="false"></p-columnFilter>
                  </th>
                  <th>
                    <p-columnFilter type="numeric" field="quantity" [showClearButton]="false"></p-columnFilter>
                  </th>
                  <th>
                    <p-columnFilter type="numeric" field="countedQty" [showClearButton]="false"></p-columnFilter>
                  </th>
                  <th>
                    <p-columnFilter type="text" field="itemDim1Code" [showClearButton]="false"></p-columnFilter>
                  </th>
                  <th>
                    <p-columnFilter type="text" field="colorDescription" [showClearButton]="false"></p-columnFilter>
                  </th>
                  <th>
                    <p-columnFilter type="numeric" field="currentQty" [showClearButton]="false"></p-columnFilter>
                  </th>
                  <th></th>
                </tr>
              </ng-template>

              <ng-template pTemplate="body" let-product>
                <tr>
                  <td>
                    <p-tableCheckbox [value]="product"></p-tableCheckbox>
                  </td>
                  <td>
                    <p-image src="{{ product.photoUrl }}" previewImageSrc="{{ product.photoUrl }}" alt="Image"
                      width="30" [preview]="true"></p-image>
                  </td>
                  <td>{{ product.shelfNo }}</td>
                  <td>{{ product.itemCode }}</td>
                  <td>{{ product.itemDescription.substring(0, 30) }}</td>
                  <td>{{ product.barcode }}</td>
                  <td>{{ product.quantity }}</td>
                  <td>{{ product.countedQty }}</td>
                  <td>{{ product.itemDim1Code }}</td>
                  <td>{{ product.colorDescription }}</td>
                  <td>{{ product.currentQty }}</td>
                  <td>
                    <div class="btn-group" role="group" aria-label="Basic example">
                      <button class="btn btn-primary" type="submit"
                        (click)="setToTop(product.barcode, product.shelfNo, product.itemCode)">
                        <i class="fa fa-angle-up"></i>
                      </button>
                      <button class="btn btn-primary" type="submit" (click)="getShelves(product.barcode)">
                        <i class="fa fa-bars"></i>
                      </button>
                    </div>
                  </td>
                </tr>
              </ng-template>
            </p-table>
          </div>
        </div>

        <div class="card" *ngIf="lastCollectedProducts.length > 0">
          <p-table [value]="lastCollectedProducts" class="table" [paginator]="true" [rows]="10"
            [tableStyle]="{ 'min-width': '50rem' }"
            [globalFilterFields]="['shelfNo', 'itemCode', 'quantity', 'barcode']">

            <ng-template pTemplate="caption">
              <div class="flex align-items-center justify-content-between">
                Toplanan Ürünler

              </div>
            </ng-template>

            <ng-template pTemplate="header">
              <tr>
                <th pSortableColumn="id">
                  Id
                  <p-sortIcon field="id"></p-sortIcon>
                </th>
                <th scope="col">Fotoğraf</th>
                <th pSortableColumn="shelfNo" *ngIf="this.user.useShelfWhenPickingOrders">
                  Raf
                  <p-sortIcon field="shelfNo"></p-sortIcon>
                </th>
                <th pSortableColumn="itemCode">
                  Ürün Kodu
                  <p-sortIcon field="itemCode"></p-sortIcon>
                </th>
                <th pSortableColumn="quantity">
                  {{this.user.useShelfWhenPickingOrders ==true  ?'Rafa Giren Miktar' : 'Toplanan Miktar'}}
                  <p-sortIcon field="quantity"></p-sortIcon>
                </th>
                <th pSortableColumn="barcode">
                  Barkod
                  <p-sortIcon field="barcode"></p-sortIcon>
                </th>
                <th scope="col">İşlemler</th>
              </tr>
              <tr>
                <th></th> <!-- Id sütunu için filtre yok -->
                <th></th> <!-- Fotoğraf sütunu için filtre yok -->
                <th *ngIf="this.user.useShelfWhenPickingOrders">
                  <p-columnFilter type="text" field="shelfNo" [showClearButton]="true"></p-columnFilter>
                </th>
                <th>
                  <p-columnFilter type="text" field="itemCode" [showClearButton]="true"></p-columnFilter>
                </th>
                <th>
                  <p-columnFilter type="numeric" field="quantity" [showClearButton]="true"></p-columnFilter>
                </th>
                <th>
                  <p-columnFilter type="text" field="barcode" [showClearButton]="true"></p-columnFilter>
                </th>
                <th></th> <!-- İşlemler sütunu için filtre yok -->
              </tr>
            </ng-template>

            <ng-template pTemplate="body" let-product let-i="index">
              <tr>
                <td>{{ i + 1 }}</td>
                <td>
                  <p-image src="{{ product.photoUrl }}" previewImageSrc="{{ product.photoUrl }}" alt="Image" width="30"
                    [preview]="true"></p-image>
                </td>
                <td *ngIf="this.user.useShelfWhenPickingOrders">{{ product.shelfNo }}</td>
                <td>{{ product.itemCode }}</td>
                <td>{{ product.quantity }}</td>
                <td>{{ product.barcode }}</td>
                <td>
                  <div class="btn-group">
                    <button class="btn btn-primary" type="submit" (click)="deleteOrderProduct(orderNo, product)">
                      <i class="fas fa-trash"></i>
                    </button>
                  </div>
                </td>
              </tr>
            </ng-template>
          </p-table>
        </div>

        <!-- Yeni kart: Toplanan Ürünler -->
        <div div class="card text-center">
          <div class="card-body">
            <h5 class="card-title">Toplanan Ürünler</h5>
            <h1 class="display-1">{{ totalCount }}</h1>
            <!--eklenen ürün miktarı yazcak! -->

            <p class="card-text">Adet Ürün Toplandı</p>
          </div>
        </div>
      </div>
    </div>
    <!-- Yeni -->
    <!-- <qrcode
      style="display: none"
      (qrCodeURL)="onChangeURL($event)"
      [qrdata]="qrCodeValue"
      [width]="256"
      [errorCorrectionLevel]="'M'"
    ></qrcode> -->

    <!-- <app-image-modal
      [imageUrl]="modalImageUrl"
      [title]="'Ürün Detay'"
    ></app-image-modal> -->


    <p-dialog header="Raflar" [(visible)]="productShelvesDialog">
      <div class="btn-group mr-2" role="group" aria-label="First group">
        <button *ngFor="let shelve of productShelves; let i = index" (click)="setShelveToForm(shelve)" type="button"
          [ngClass]="i % 2 === 0 ? 'btn btn-primary' : 'btn btn-secondary'" style="height: 10rem">
          {{ shelve }}
        </button>
      </div>
    </p-dialog>

  </section>
</main>
